import{a3 as m,a4 as c}from"./_applist-952.js";import{dx as d,_ as o}from"./main-red-poems-invite.js";import{s as u}from"./machine.-578.js";import"./lodash-840.js";import"./mutative-12.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const r="https://api.elasticemail.com/v4",C=async t=>d({headers:{Accept:"*/*","X-ElasticEmail-ApiKey":{encryption:"hmac_decrypt",value:t}},method:"GET",url:`${r}/lists`});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const s=async t=>{t.setComponent("list-ids",i=>{i.loading=!0});const e=await t.getConnection();if(!e){t.setComponent("list-ids",i=>{i.loading=!1});return}const{data:a,status:n}=await C(e.auth_details.value);if(n==="error"){t.setComponent("list-ids",i=>{t.util.isSelectComponent(i)&&(i.status=n,i.invalidMessage=a)}),console.error("Failed to fetch contact list");return}t.setComponent("list-ids",i=>{t.util.isSelectComponent(i)&&(i.options=a==null?void 0:a.map(l=>({label:l.ListName,value:l.ListName})),i.loading=!1)})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const _=m(({helpers:t})=>({states:{components:[{addConnectionHelpingText:o('You can get your API key from <a class="text-blue-600 underline" href="https://app.elasticemail.com/marketing/settings/new" target="_blank" rel="noopener noreferrer nofollow">here</a>'),componentName:t.componentName.connection,connectionsTypes:[{encryptKeys:["value"],label:o("API Key"),showKey:!1,type:"api_key",verifyConnection:{headers:{Accept:"*/*","X-ElasticEmail-ApiKey":""},method:"GET",responseKeyMatch:["[0].Email","[0].Status","[0].FirstName","[0].LastName"],url:"https://api.elasticemail.com/v4/contacts"}}],fieldType:"config",id:"connection-id",label:o("Select Connection"),onConnectionAddChange:"CONNECTION_ADD_CHANGE",onConnectionChange:"SET_CONNECTION",render:!0,value:void 0},{componentName:t.componentName.select,fieldType:"config",id:"list-ids",label:o("Contact Lists"),mode:"multiple",onChange:"SELECT_LIST",onRefetch:"REFETCH_CONTACT_LISTS",optionFilterProp:"label",options:[],placeholder:o("Select Lists"),render:"IF_CONNECTION_SELECTED",showSearch:!0,value:void 0},{componentName:t.componentName.select,fieldType:"config",id:"status-id",label:o("Contact Status"),onChange:"SELECT_STATUS",optionFilterProp:"label",options:[{label:o("Transactional"),value:"Transactional"},{label:o("Engaged"),value:"Engaged"},{label:o("Active"),value:"Active"},{label:o("Bounced"),value:"Bounced"},{label:o("Unsubscribed"),value:"Unsubscribed"},{label:o("Abuse"),value:"Abuse"},{label:o("Inactive"),value:"Inactive"},{label:o("Stale"),value:"Stale"},{label:o("NotConfirmed"),value:"NotConfirmed"}],placeholder:o("Select Status"),render:"IF_CONNECTION_SELECTED",showSearch:!0,value:void 0},{addItemButtonLabel:o("Add Column"),componentName:t.componentName.repeaterField,fieldsMetaData:[{componentName:t.componentName.select,label:o("Elastic Mail Field"),name:"elasticMailField",options:[{label:o("Email"),value:"Email"},{label:o("FirstName"),value:"FirstName"},{label:o("LastName"),value:"LastName"}],required:!0,style:{width:150},value:""},{componentName:t.componentName.mixInput,label:o("Value"),name:"value",required:!0,value:[],wrapperClassName:"w-100"}],id:"contact-fields",label:o("Field Mapping"),onChange:"ON_FIELD_MAP_CHANGE",render:"IF_LIST_SELECTED",value:[]},{addItemButtonLabel:o("Add Column"),componentName:t.componentName.repeaterField,fieldsMetaData:[{componentName:t.componentName.input,label:o("Custom Field"),name:"elasticMailCustomField",required:!0,style:{width:150},value:""},{componentName:t.componentName.mixInput,label:o("Value"),name:"value",required:!0,value:[],wrapperClassName:"w-100"}],id:"custom-fields",label:o("Custom Field Mapping"),onChange:"ON_CUSTOM_FIELD_MAP_CHANGE",render:"IF_LIST_SELECTED",value:[]}]},actions:{ON_MACHINE_LOAD:async({$:e})=>{u(e,[{db:"connectionId",id:"connection-id"},{db:"listIds",id:"list-ids"},{db:"statusId",id:"status-id"},{db:"contactFields",id:"contact-fields"},{db:"customFields",id:"custom-fields"}]),await s(e)},CONNECTION_ADD_CHANGE:({$:e,e:a})=>{e.setThisComponent(n=>{e.util.isConnectionComponent(n)&&n.connectionsTypes.forEach(i=>{var l;i.type==="api_key"&&((l=i.verifyConnection)!=null&&l.headers)&&(i.verifyConnection.headers["X-ElasticEmail-ApiKey"]=a.value)})})},REFETCH_CONTACT_LISTS:async({$:e})=>{await s(e)},SELECT_LIST:async({$:e,e:a})=>{e.setThisComponent(n=>{n.value=a}),e.setDb(n=>{n.listIds=a})},SELECT_STATUS:({$:e,e:a})=>{e.setThisComponent(n=>{n.value=a}),e.setDb(n=>{n.statusId=a})},IF_CONNECTION_SELECTED:({$:e})=>{var a;return c((a=e.getComponent("connection-id"))==null?void 0:a.value)},IF_LIST_SELECTED:({$:e})=>{var a;return c((a=e.getComponent("list-ids"))==null?void 0:a.value)},ON_CUSTOM_FIELD_MAP_CHANGE:({$:e,e:a})=>{e.setThisComponent(n=>{n.value=a}),e.setDb(n=>{n.customFields=a})},ON_FIELD_MAP_CHANGE:({$:e,e:a})=>{e.setThisComponent(n=>{n.value=a}),e.setDb(n=>{n.contactFields=a})},SET_CONNECTION:async({$:e,e:a})=>{e.setThisComponent(n=>{n.value=a}),e.setDb(n=>{n.connectionId=a}),await s(e)}}}));export{_ as default};
