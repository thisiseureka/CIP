const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./template-946.js","./_applist-952.js","./lodash-840.js","./main-red-poems-invite.js","./main-bit-pi-ba-assets-red-poems-invite.css","./mutative-12.js","./template-19.js"])))=>i.map(i=>d[i]);
import{r as n,I as Le,b as Be,c as ze,u as de,q as I,d as le,e as ue,f as Ue,g as q,h as Re,k as He,j as a,A as Q,a as d,i as se,_ as s,B as O,L as ge,t as be,l as N,m as Te,n as we,S as G,o as Ce,N as ve,F as ye,p as Ke,s as qe,v as Ae,w as Ve,x as ae,y as We,R as Fe,z as Ge,C as Qe,D as Xe}from"./main-red-poems-invite.js";import{m as Je,D as xe,a as Ye,b as Ze,F as et,u as tt}from"./dropdown-694.js";import{$ as Me,d as re,a as at,A as ot}from"./_applist-952.js";import{c as st}from"./react-451.js";import{I as ie}from"./index-383.js";import{T as $,R as ke}from"./index-384.js";import{c as ne}from"./mutative-12.js";import{M as V}from"./exporthe-973.js";import{F as he,l as it}from"./links-564.js";import{T as ct}from"./index-567.js";import{S as lt}from"./index-469.js";import{S as rt}from"./index-747.js";import{C as me}from"./col-740.js";import{I as nt}from"./index.es-493.js";import{E as pe}from"./index-630.js";import{P as ht}from"./paginati-257.js";import"./index-35.js";import"./lodash-840.js";import"./skeleton-352.js";import"./context-230.js";import"./searchou-927.js";import"./usebreak-848.js";var dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},ut=function(t,o){return n.createElement(Le,Be({},t,{ref:o,icon:dt}))},je=n.forwardRef(ut);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function gt(){const[e,t]=ze(Me),{data:o,isLoading:i}=de({queryFn:({signal:l})=>I("custom-apps-active",void 0,void 0,"GET",{signal:l}),queryKey:["appList"],select:l=>Je(l.data)});return n.useEffect(()=>{Array.isArray(o)&&t(l=>[...l.filter(h=>!h.isCustom),...o])},[o,t]),{appList:e,isAppLoading:i}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const fe=Object.assign({"../templates/template-1.ts":()=>le(()=>import("./template-946.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url),"../templates/template-2.ts":()=>le(()=>import("./template-19.js"),__vite__mapDeps([6,1,2,3,4,5]),import.meta.url),"../templates/templates.ts":()=>le(()=>Promise.resolve().then(()=>Et),void 0,import.meta.url)}),X=st((e,t)=>({errorMessage:"",flowData:re,flowTitle:"Untitled Flow",handleFlowTitleChange:o=>{e(i=>({...i,flowTitle:o,isTitleChangedByUser:!0}))},handleModal:o=>{e(i=>({...i,flowData:re,flowTitle:"Untitled Flow",isCreateFlowModalOpen:o,isTitleChangedByUser:!1,selectedTemplateId:o&&"blank"}))},isCreateFlowModalOpen:!1,isFetchingTemplate:!1,isTitleChangedByUser:!1,selectedTemplateId:"blank",selectTemplate:async(o,i)=>{var l;if(o==="blank"){if(e(h=>({...h,flowData:re,selectedTemplateId:o})),t().isTitleChangedByUser)return;e({flowTitle:"Untitled Flow"});return}e({isFetchingTemplate:!0});for(const h in fe)if((l=h.split("/").at(-1))!=null&&l.includes(`${o}.ts`)){const m=await fe[h]();e(T=>({...T,flowData:m.default,selectedTemplateId:o})),t().isTitleChangedByUser||e({flowTitle:i});break}e({isFetchingTemplate:!1})},setCreateFlowModalOpen:o=>e({isCreateFlowModalOpen:o}),setErrorMessage:o=>e({errorMessage:o}),setFlowData:o=>e({flowData:o}),setSelectedTemplateId:o=>e({selectedTemplateId:o})}));globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function mt(){const e=ue(at),t=Ue(),{setCreateFlowModalOpen:o}=X(),{isPending:i,mutateAsync:l}=q({mutationFn:async h=>I("flows/save",h),mutationKey:["save_flow"],onSuccess:h=>{h.data.id&&(e(h.data),o(!1),t(`/flows/details/${h.data.id}`))}});return{isFlowSaving:i,saveFlow:l}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ce=globalThis.jotaiAtomCache.get("/home/runner/work/bit-pi/bit-pi/frontend/src/common/globalStates/$flows.ts/$flows",Re([]));ce.debugLabel="$flows";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function pt(e){const t=ue(ce),o=e.searchKeyValue.tags.join(""),{data:i,isFetching:l,isLoading:h}=de({placeholderData:He,queryFn:()=>I("flows/search",e),queryKey:["search_flows",e.page,e.limit,o,e.searchKeyValue.title],select:m=>m.data});return n.useEffect(()=>{t((i==null?void 0:i.flows)||[])},[i==null?void 0:i.flows,t]),{fetchedFlows:(i==null?void 0:i.flows)||[],isFlowsFetching:l,isFlowsLoading:h,totalFetchedFlow:(i==null?void 0:i.totalFlows)||0}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ft(){const{mutateAsync:e}=q({mutationFn:async t=>I("tags/delete",{tagId:t}),mutationKey:["delete_tags"]});return{deleteTag:e}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function bt(){const{isPending:e,mutateAsync:t}=q({mutationFn:async o=>I("tags/save",{title:o}),mutationKey:["save_tags"]});return{isSavingTag:e,saveTag:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function _e(){const{data:e,isLoading:t,refetch:o}=de({queryFn:async()=>I("tags",void 0,void 0,"GET"),queryKey:["all_tags"]});return{isTagsLoading:t,refetchTag:o,tags:(e==null?void 0:e.data)||[]}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Tt(){const{isPending:e,mutateAsync:t}=q({mutationFn:async o=>I("tags/update",o),mutationKey:["update_tags"]});return{isUpdatingTag:e,updateTag:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function wt(){const{isPending:e,mutateAsync:t}=q({mutationFn:async o=>I("tags/updateStatus",o),mutationKey:["update_tag_status"]});return{isUpdatingTagStatus:e,updateTagStatus:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ct({className:e,size:t="1em",stroke:o=.2}){return a(Q,{children:a("svg",{className:e,fill:"currentColor",height:t,stroke:"currentColor",strokeWidth:o,viewBox:"0 0 16 16",width:t,children:a("path",{d:`M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588c-.177 0-.335-.018-.46-.039l-3.134 3.134a5.927 5.927 0 0 1 .16 1.013c.046.702-.032
           1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828l-3.182 3.182c-.195.195-1.219.902-1.414.707c-.195-.195.512-1.22.707-1.414l3.182-3.182l-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688
           1.673-.767 2.375-.72a5.922 5.922 0 0 1 1.013.16l3.134-3.133a2.772 2.772 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146zm.122 2.112v-.002v.002zm0-.002v.002a.5.5 0
           0 1-.122.51L6.293 6.878a.5.5 0 0 1-.511.12H5.78l-.014-.004a4.507 4.507 0 0 0-.288-.076a4.922 4.922 0 0 0-.765-.116c-.422-.028-.836.008-1.175.15l5.51 5.509c.141-.34.177-.753.149-1.175a4.924
           4.924 0 0 0-.192-1.054l-.004-.013v-.001a.5.5 0 0 1 .12-.512l3.536-3.535a.5.5 0 0 1 .532-.115l.096.022c.087.017.208.034.344.034c.114 0 .23-.011.343-.04L9.927 2.028c-.029.113-.04.23-.04.343a1.779 1.779 0 0 0 .062.46z`})})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function vt({className:e,size:t="1em"}){return a(Q,{children:a("svg",{className:e,fill:"currentColor",height:t,viewBox:"0 0 16 16",width:t,children:a("path",{d:`M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588c-.177 0-.335-.018-.46-.039l-3.134
          3.134a5.927 5.927 0 0 1 .16 1.013c.046.702-.032 1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828l-3.182
          3.182c-.195.195-1.219.902-1.414.707c-.195-.195.512-1.22.707-1.414l3.182-3.182l-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688 1.673-.767
          2.375-.72a5.922 5.922 0 0 1 1.013.16l3.134-3.133a2.772 2.772 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146z`})})})}const yt="_tagList_t1o7c_5",At="_tagItem_t1o7c_15 flx ai-cen jc-sb pos-rel",Ft="_tagItemActionBtn_t1o7c_20",xt="_pinTag_t1o7c_28",Mt="_tagItemAction_t1o7c_20 pos-abs",kt="_tagItemTitle_t1o7c_37",K={tagList:yt,tagItem:At,tagItemActionBtn:Ft,pinTag:xt,tagItemAction:Mt,tagItemTitle:kt};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const jt=({handleOnAdd:e,isAddable:t,token:o})=>function(l){return d("div",{css:se({backgroundColor:o.colorBgElevated,borderRadius:o.borderRadiusLG,boxShadow:o.boxShadowSecondary},"",""),children:[a($.Title,{"aria-label":s("tags list"),className:"m-1 px-2 py-1 text-sm",css:se({borderBottom:`1px solid ${o.colorSplit}`},"",""),level:5,children:s("Tags")}),n.cloneElement(l,{style:{boxShadow:"none"}}),t&&a("div",{className:"p-2",children:a(O,{"aria-label":s("add tag"),block:!0,icon:a(ge,{}),onClick:e,size:"small",children:s("Add Tag")})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};var _t={name:"158icaa",styles:"margin-left:4px"};function St({className:e,onActive:t,onAdd:o,onEdit:i,onInactive:l,onPin:h,onRemove:m,onUnpin:T,tagsList:g}){const{token:C}=be.useToken(),[v,F]=n.useState(!1),_=n.useMemo(()=>g==null?void 0:g.every(c=>!c.active),[g]),P=()=>_?[]:g==null?void 0:g.filter(c=>c.active).map(c=>c.id.toString()),f=()=>{o==null||o(),F(!1)},x=c=>M=>{M.stopPropagation(),i==null||i(c),F(!1)},w=c=>M=>{M.stopPropagation(),m==null||m(c),F(!1)},p=(c,M)=>y=>{y.stopPropagation(),M?T==null||T(c):h==null||h(c)},S=g==null?void 0:g.map(c=>({key:c.id,label:d("div",{className:N([K.tagItem,"group"]),css:se({borderRadius:C.borderRadius,paddingBlock:2},"",""),children:[d("span",{className:K.tagItemTitle,children:[h&&a(O,{"aria-label":s("pin or unpin tag"),className:N([c.pinned&&K.pinTag,c.active&&"group-hover:text-white"]),icon:Number(c.pinned)?a(vt,{size:12}):a(Ct,{size:12}),onClick:p(c.id,c.pinned),size:"small",type:"text"}),a("span",{"aria-label":`tag-${c.id}`,className:N([c.active&&"group-hover:text-white"]),css:_t,children:c.label})]}),d("div",{className:`${K.tagItemAction}`,children:[i&&a(O,{"aria-label":s("edit tag"),className:N([K.tagItemActionBtn,c.active&&"group-hover:text-white"]),icon:a(Te,{size:13}),onClick:x(c.id),size:"small",type:"text"}),m&&a(O,{"aria-label":s("delete tag"),className:N([K.tagItemActionBtn,c.active&&"group-hover:text-white"]),icon:a(we,{size:13}),onClick:w(c.id),size:"small",type:"text"})]})]})}));return d(G,{className:e,size:4,children:[a(O,{"aria-label":s("All tags"),onClick:()=>_?l(0):t(0),shape:"round",type:`${_?"primary":"default"}`,children:s("All")}),g==null?void 0:g.map(c=>c.pinned&&a(O,{"aria-label":s("pinned tag"),onClick:()=>c.active?l(c.id):t(c.id),shape:"round",type:`${c.active?"primary":"default"}`,children:c.label},c.id)),a(xe,{arrow:!0,dropdownRender:jt({handleOnAdd:f,isAddable:!!o,token:C}),menu:{className:`${K.tagList} scroller thin`,items:S,multiple:!0,onDeselect:c=>l(Number(c.key)),onSelect:c=>t(Number(c.key)),selectable:!0,selectedKeys:P()},onOpenChange:F,open:v,placement:"bottom",trigger:["click"],children:a(O,{"aria-label":s("more tags"),icon:a(Ce,{}),shape:"circle"})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Nt({activeTag:e,setActiveTag:t}){var ee,te;const{refetchTag:o,tags:i}=_e(),{isSavingTag:l,saveTag:h}=bt(),{isUpdatingTag:m,updateTag:T}=Tt(),{updateTagStatus:g}=wt(),{deleteTag:C}=ft(),{messageApi:v}=n.useContext(ve),[F,_]=n.useState(!1),[P,f]=n.useState(!1),[x,w]=n.useState(""),[p,S]=n.useState(),[c,M]=V.useModal(),y=n.useRef(),D=u=>{t(A=>ne(A,k=>{if(u===0)return[];if(A.includes(u))return k.filter(W=>W!==u);k.push(u)}))},z=async()=>{const{data:u,status:A}=await h(x).catch(k=>k);if(A==="error"){S(u);return}w(""),_(!1),o(),S(void 0),v==null||v.success("Tag created successfully")},b=async()=>{y.current&&(await C(y.current),o(),v==null||v.success("Tag deleted successfully"))},L=u=>{y.current=u,c.confirm({content:"If you delete you can't recover it",icon:a(je,{}),okText:s("Delete"),onOk:b,title:s("Are you Confirm to Delete?")})},B=u=>{const A=i.find(k=>k.id===u);A&&(y.current=u,w(A.title),f(!0))},J=async u=>{const A=i.find(k=>k.id===u);A&&(await g({id:u,status:!Number(A.status)}),o())},E=()=>{w(""),_(!0)},Y=u=>async()=>{const{data:A,status:k}=await T({id:u,title:x}).catch(W=>W);if(k==="error"){S(A);return}w(""),f(!1),o(),S(void 0)},Z=i.map(u=>({active:e.includes(u.id),id:u.id,label:u.title,pinned:!!Number(u.status)}));return d(ye,{children:[M,a(St,{className:"mb-4 mt-2",onActive:D,onAdd:E,onEdit:B,onInactive:D,onPin:J,onRemove:L,onUnpin:J,tagsList:Z}),a(V,{closeIcon:a(Ke,{}),confirmLoading:l,okButtonProps:{disabled:!x.length},okText:s("Save"),onCancel:()=>_(!1),onOk:z,open:F,title:s("Create Tag"),children:a("div",{className:"mt-4",children:a(he,{onSubmitCapture:z,children:a(ie,{invalidMessage:(ee=p==null?void 0:p.title)==null?void 0:ee[0],name:"tagName",onChange:u=>w(u.target.value),placeholder:s("Write tag name"),status:(p==null?void 0:p.title)&&"error",title:s("Tag name"),value:x})})})},`tag-confirmation-modal-${n.useId}`),a(V,{confirmLoading:m,okButtonProps:{disabled:!x.length},okText:s("Update"),onCancel:()=>f(!1),onOk:Y(y.current||0),open:P,title:s("Edit Tag"),children:a(he,{onSubmitCapture:Y(y.current||0),children:a(ie,{invalidMessage:(te=p==null?void 0:p.title)==null?void 0:te[0],name:"title",onChange:u=>w(u.target.value),placeholder:s("Edit tag name"),status:(p==null?void 0:p.title)&&"error",title:s("Tag name"),value:x})})},`tag-edit-modal-${n.useId}`)]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function It({className:e,link:t,text:o,wrapperClassName:i}){return d("span",{className:N("inline-flex gap-1 text-orange-500 decoration-wavy underline-offset-2 hover:text-orange-600 hover:underline",i),children:[a("a",{className:N(["text-orange-500 hover:text-orange-600",e]),href:`${t}?utm_source=flow_plugin`,rel:"noreferrer noopener nofollow",target:"_blank",children:o}),a(qe,{})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Se=[{description:s("Create from scratch."),id:"blank",logos:[],name:s("Blank"),nodeCount:0},{description:s("Manage bulk data and send it to MailChimp and Google Sheets  (handled and filtered by tools)."),id:"template-1",logos:["webhook","googleSheet","mailChimp"],name:s("Example Flow"),nodeCount:2,proRequired:!0},{description:s("Send data to MailerLite and Brevo using the router after forms new record."),id:"template-2",logos:["elementorForm","mailerLite","brevo"],name:s("Elementor Form to Email Marketing"),nodeCount:3}],Et=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"})),Ot="_itemHeader_1tc0g_14 flx ai-cen jc-sb",$t="_itemHeaderIcon_1tc0g_19",Pt="_imgWrap_1tc0g_23",Dt="_nodesCount_1tc0g_50",oe={itemHeader:Ot,itemHeaderIcon:$t,imgWrap:Pt,nodesCount:Dt};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Lt({nodes:e,nodesCount:t}){const o=Ae(Me),{token:i}=be.useToken(),l=t-3,h=n.useMemo(()=>e.map(m=>{const{color:T,logoUrl:g}=o.find(C=>C.appSlug===m)||{};return{appSlug:m,color:T,logoUrl:g}}),[o,e]);return a("div",{className:oe.itemHeaderIcon,children:h==null?void 0:h.map(({appSlug:m,color:T,logoUrl:g},C)=>d("span",{className:oe.imgWrap,css:se({backgroundColor:T||ot,border:`1px solid ${Ve(T,-100)}`,outline:`3px solid ${i.colorBgContainer}`},"",""),children:[g&&a("img",{alt:m,className:"p-1.5",src:g}),C===2&&l>0&&a("span",{className:oe.nodesCount,children:`${l}+`})]},`${m}-${C*2}`))})}const Ne=n.memo(Lt);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Bt({template:e}){const{isFetchingTemplate:t,selectedTemplateId:o,selectTemplate:i}=X();return d("button",{className:N(["group relative flex cursor-pointer flex-row items-center gap-4 rounded-md border border-solid border-slate-300 bg-transparent px-4 py-3","hover:border-slate-400 hover:bg-slate-100","dark:border-slate-700 dark:hover:border-slate-600 dark:hover:bg-white/5",o===e.id&&"border-orange-500 ring-2 ring-orange-500"]),disabled:t,onClick:()=>i(e.id,e.name),type:"button",children:[d("div",{className:"flex w-full items-center gap-3",children:[d("div",{className:"flex w-24 items-center justify-start",children:[a(ae,{conditions:[e.logos.length>0,e.id!=="blank"],children:a(Ne,{nodes:e.logos,nodesCount:e.nodeCount})}),a(ae,{conditions:e.id==="blank",children:a("div",{className:"my-1 flex h-12 w-full items-center justify-center rounded-md bg-slate-100 group-hover:bg-slate-200 dark:bg-slate-800 group-hover:dark:bg-slate-700",children:a(ge,{className:"opacity-70",size:24})})})]}),d("div",{className:"flex-1",children:[a($.Paragraph,{className:N(["mb-0 block rounded-sm text-start text-sm font-medium","group-hover:text-orange-400",o===e.id&&"text-orange-600 dark:text-orange-500"]),children:e.name}),a($.Paragraph,{className:"mb-0 text-start text-xs text-slate-500",children:e.description})]})]}),a(ae,{conditions:[e.proRequired,!We.IS_PRO],children:a(ct,{className:"absolute right-0 top-0 m-0 rounded-br-none rounded-tl-none rounded-tr-md text-xs",color:"orange",rootClassName:"border-t-0 border-r-0",children:a($.Text,{className:"text-xs",children:s("Requires Pro")})})})]},e.id)}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function zt(){const{isFetchingTemplate:e}=X();return d("div",{className:"mb-10 mt-10 flex flex-col gap-3",children:[d("div",{className:"flex justify-between",children:[d("div",{children:[a($.Text,{className:"text-sm font-medium",children:s("Choose template:")}),e&&a(Fe,{})]}),a(It,{link:it.getStarted,text:"Get started (Guide)"})]}),Se.map(t=>a(Bt,{template:t},t.id))]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ut({className:e,size:t="1em",stroke:o=2}){return a(Q,{children:d("svg",{className:e,fill:"none",height:t,stroke:"currentColor",strokeMiterlimit:"10",strokeWidth:o,viewBox:"0 0 25 33.1",width:t,children:[a("path",{d:"M20.5 7.7v13.8a4 4 0 0 1-4 4 4 4 0 0 1-4-4v-9.8a4 4 0 0 0-8 0v13.8"}),a("circle",{cx:"20.5",cy:"4.5",r:"3.5"}),a("circle",{cx:"4.5",cy:"28.6",r:"3.5"})]})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Rt(){const{data:e,isPending:t,mutateAsync:o}=q({mutationFn:async i=>I("flows/delete",i),mutationKey:["delete_flow"]});return{deleteFlowData:e,deleteFlowMutate:o,isDeleteFlowLoading:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ht(){const{data:e,error:t,isError:o,isPending:i,mutateAsync:l}=q({mutationFn:async h=>I("flows/update",h),mutationKey:["update_flow"]});return{flowUpdateError:t,isFlowUpdateError:o,isFlowUpdating:i,updateFlow:l,updateFlowData:e==null?void 0:e.data}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Kt({count:e,flowTags:t,id:o,isFlowActive:i,nodes:l,nodesCount:h,title:m}){const[T,g]=n.useState(i),{deleteFlowMutate:C}=Rt(),{flowUpdateError:v,isFlowUpdateError:F,isFlowUpdating:_,updateFlow:P,updateFlowData:f}=Ht(),[x,w]=n.useState(m),p=ue(ce),[S,c]=n.useState({isActive:!1,layoutId:""}),{refetchTag:M,tags:y}=_e(),[D,z]=n.useState(""),{messageApi:b}=n.useContext(ve),[L,B]=n.useState(!1),J=t==null?void 0:t.map(r=>r.title),[E,Y]=n.useState(J),Z=()=>{c({isActive:!1,layoutId:""}),z("")},ee=r=>()=>{C({id:r}),p(j=>ne(j,U=>U.filter(R=>Number(R.id)!==r))),b==null||b.success(s("Flow deleted successfully"))},te=(r,j,U)=>{j.preventDefault(),j.stopPropagation(),g(r),P({flow:{is_active:Number(r)},id:U}),b==null||b.success(s("Status updated successfully"))},u=r=>async()=>{const j=E==null?void 0:E.filter(H=>!y.some(De=>De.title===H)),R=y.filter(H=>E==null?void 0:E.includes(H.title)).map(H=>H.id);try{await P({flow:{title:x},id:r,tag:{newTags:j,oldTagsId:R}}),Z(),b==null||b.success(s("Flow updated successfully"))}catch(H){console.error(H)}},[A,k]=V.useModal(),W=(r,j)=>{r.stopPropagation(),A.confirm({content:s("If you delete you can't recover it"),icon:a(je,{}),okText:s("Delete"),onOk:ee(Number(j)),title:s("Are you Confirm to Delete?")})},Ie=r=>{r.stopPropagation(),B(!0)},Ee=y.map(r=>({label:r.title,value:r.title})),Oe=r=>{r.stopPropagation(),c({isActive:!0,layoutId:`flowDetails-${o}`})},$e=[{key:"edit",label:d(G,{size:6,children:[a(Q,{children:a(Te,{})}),s("Edit")]}),onClick:({domEvent:r})=>Oe(r)},{key:"settings",label:a(Ye,{}),onClick:({domEvent:r})=>Ie(r)},{key:"export",label:a(Ze,{flowId:o}),onClick:({domEvent:r})=>r.stopPropagation()},{danger:!0,key:"delete",label:d(G,{size:6,children:[a(Q,{children:a(we,{})}),s("Delete")]}),onClick:({domEvent:r})=>W(r,o)}],Pe=r=>{Y(r)};return n.useEffect(()=>{F&&v&&z(Object.values(v.data).flat().join(", "))},[v,F]),n.useEffect(()=>{w(m)},[m]),n.useEffect(()=>{g(i)},[i]),n.useEffect(()=>{var r;f&&"flowDetails"in f&&p(j=>ne(j,U=>(U.forEach(R=>{R.id===f.flowDetails.id&&(R.flowTags=f.flowDetails.flowTags,R.title=f.flowDetails.title)}),U))),f&&((r=f==null?void 0:f.insertedNewTags)!=null&&r.length)&&M()},[M,p,f]),d(ye,{children:[k,a(Ge,{to:`../flows/details/${o}`,children:d("div",{className:N(["group h-[118px] rounded-md border border-solid p-3 shadow-sm outline-2 outline-offset-2 transition-all focus-within:outline","border-slate-300 bg-white outline-slate-900","hover:border-slate-400 hover:bg-slate-100","dark:border-slate-700 dark:bg-transparent dark:outline-slate-300 dark:hover:border-slate-600 dark:hover:bg-slate-900"]),"data-testid":"flowItem",children:[d("div",{className:oe.itemHeader,children:[a(Ne,{nodes:l,nodesCount:h}),d(G,{children:[a(xe,{arrow:!0,menu:{items:$e},placement:"bottom",trigger:["click"],children:a(O,{"data-testid":"flowItemMenu",icon:a(Ce,{}),onClick:r=>r.preventDefault(),shape:"circle",type:"text"})}),a(rt,{checked:T,onChange:(r,j)=>te(r,j,Number(o)),size:"small"})]})]}),a($.Text,{className:"my-2 block rounded-sm text-base font-medium group-hover:text-orange-500",ellipsis:!0,children:m}),d($.Text,{children:[a(Ut,{size:13})," ",e]})]})}),d(V,{confirmLoading:_,destroyOnClose:!0,okText:s("Update"),onCancel:Z,onOk:u(Number(o)),open:S.isActive,title:s("Edit Flow"),children:[a(ie,{label:s("Title"),name:`editFlowTitle-${o}`,onChange:r=>w(r.target.value),placeholder:s("Edit flow title"),type:"text",value:x}),a(lt,{invalidMessage:D,label:s("Tags"),mode:"tags",onChange:Pe,options:Ee,placeholder:s("Tags"),status:D&&"error",value:E,wrapperClassName:"mt-2"})]}),a(et,{flowId:o,isOpen:L,setIsOpen:B})]})}const qt=n.memo(Kt);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Vt({totalFetchedFlow:e}){const t=Ae(ce),{handleModal:o}=X(),i=n.useCallback(l=>l.length>3?l.slice(0,3):l,[]);return d(ke,{gutter:[16,16],children:[a(me,{lg:6,md:8,sm:12,xs:24,children:a(O,{"aria-label":s("Create Flow"),className:"h-[116px] w-full rounded-md border-2 border-dashed border-slate-400 hover:border-slate-600 hover:bg-slate-200 dark:border-slate-700 dark:hover:bg-slate-900",onClick:()=>o(!0),variant:"dashed",children:d($.Text,{className:"flex items-center gap-2 font-medium",children:[a(ge,{size:36}),s("Create Flow")]})})}),!!e&&t&&(t==null?void 0:t.map(l=>a(me,{lg:6,md:8,sm:12,xs:24,children:a(qt,{count:l.run_count,flowTags:l.flowTags,id:l.id,isFlowActive:!!l.is_active,nodes:i(l.nodes),nodesCount:l.nodesCount,title:l.title})},l.id)))]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};var Wt={name:"1i2yey0",styles:"width:200px !important"};function fa(){const[e,t]=Qe(),o=Number(e.get("page"))||1,i=Number(e.get("limit"))||15,[l,h]=n.useState(""),m=tt(l,400),[T,g]=n.useState([]),{isFlowsFetching:C,isFlowsLoading:v,totalFetchedFlow:F}=pt({limit:i,page:o,searchKeyValue:{tags:T,title:m}}),{isFlowSaving:_,saveFlow:P}=mt(),{errorMessage:f,flowData:x,flowTitle:w,handleFlowTitleChange:p,handleModal:S,isCreateFlowModalOpen:c,setErrorMessage:M}=X();gt();const y=({target:{value:b}})=>{h(b)},D=async()=>{M(""),w||M(s("Title is required")),await P({...x,title:w})},z=(b,L)=>{t(B=>(B.set("page",b.toString()),B.set("limit",L.toString()),B))};return d("div",{className:"p-6",children:[d(ke,{align:"middle",justify:"space-between",children:[d(G,{className:"mb-3",children:[a($.Title,{className:"mb-0",level:3,children:s("Flows")}),C&&a(Fe,{})]}),a(nt,{allowClear:!0,css:Wt,onChange:y,placeholder:s("Search"),prefix:a(Xe,{}),type:"search"})]}),a(Nt,{activeTag:T,setActiveTag:g}),a(Vt,{totalFetchedFlow:F}),!v&&!C&&!F&&a(pe,{description:s("No Flow Found"),image:pe.PRESENTED_IMAGE_SIMPLE}),a(ht,{className:"mt-5 justify-end",current:o,onChange:z,pageSize:i,showSizeChanger:!0,showTotal:(b,L)=>`${L[0]}-${L[1]} of ${b} items`,total:F}),a(V,{centered:!0,confirmLoading:_,okButtonProps:{"aria-label":"Flow title save button"},okText:s("Create"),onCancel:()=>S(!1),onOk:D,open:c,title:s("Create Flow"),children:d(ae,{conditions:c,children:[a(he,{onSubmitCapture:D,children:a(ie,{"aria-label":s("Flow title input"),invalidMessage:f,label:s("Title"),name:"createFlowTitle",onChange:b=>p(b.target.value),placeholder:s("Write title here..."),status:f?"error":"",type:"text",value:w})}),a(zt,{})]})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};export{fa as default};
