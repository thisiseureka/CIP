import{a3 as m,a4 as s}from"./_applist-952.js";import{_ as n}from"./main-red-poems-invite.js";import{s as h}from"./machine.-578.js";import{f as d,h as p,a as r,b as c,s as l}from"./machineh-789.js";import"./lodash-840.js";import"./mutative-12.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(a,e){return this.cache.has(a)?this.cache.get(a):(this.cache.set(a,e),e)}};const w=m(({helpers:a})=>({states:{components:[{addConnectionHelpingText:n('You can find credentials from <a target="_blank" class="text-blue-600 underline" rel="noopener noreferrer nofollow" href="https://console.cloud.google.com/apis/credentials">Here</a>'),componentName:a.componentName.connection,connectionsTypes:[{authCodeEndpoint:{method:"GET",queryParams:{access_type:"offline",client_id:"",prompt:"consent",response_type:"code",scope:"https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.readonly"},url:"https://accounts.google.com/o/oauth2/v2/auth"},encryptKeys:["access_token","refresh_token","client_secret"],label:n("OAuth 2"),refreshTokenUrl:"https://oauth2.googleapis.com/token",tokenEndpoint:{bodyParams:{client_id:"",client_secret:"",grant_type:"authorization_code"},method:"POST",url:"https://oauth2.googleapis.com/token"},type:"oauth2",verifyConnection:{method:"GET",queryParams:{access_token:"$_access_token_$"},responseMatch:{scope:"https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.readonly"},url:"https://www.googleapis.com/oauth2/v2/tokeninfo"}}],fieldType:"config",id:"connection-id",label:n("Select Connection"),onConnectionAddChange:"CONNECTION_ADD_CHANGE",onConnectionChange:"SET_CONNECTION",render:!0,value:void 0},{componentName:a.componentName.select,fieldType:"config",id:"spreadsheet-id",label:n("Spreadsheet"),onChange:"SELECT_SPREADSHEET",onRefetch:"REFETCH_SPREADSHEETS",optionFilterProp:"label",options:[],placeholder:n("Select a spreadsheet"),render:"IF_CONNECTION_SELECTED",showSearch:!0,value:void 0},{componentName:a.componentName.select,fieldType:"config",id:"sheet-title",label:n("Sheet"),onChange:"SELECT_SHEET",onRefetch:"REFETCH_SHEETS",optionFilterProp:"label",options:[],placeholder:n("Select a sheet"),render:"IF_SPREADSHEET_SELECTED",showSearch:!0,value:void 0},{componentName:a.componentName.select,fieldType:"config",id:"contains-header-row",label:n("Worksheet contains header row"),onChange:"SET_CONTAINS_HEADER_ROW",options:[{label:n("Yes"),value:"yes"},{label:n("No"),value:"no"}],render:"IF_SHEET_SELECTED",value:void 0},{componentName:a.componentName.select,fieldType:"config",helperText:n("Select a column to match with mapped data, if selected column matches with the value in the mapped data, then the row will be updated otherwise a new row will be appended."),id:"column-to-match-on",label:n("Column to match on"),onChange:"SELECT_COLUMN_TO_MATCH",onRefetch:"REFETCH_HEADER_ROW",optionFilterProp:"label",options:[],placeholder:n("Select a column to match on"),render:"IF_COLUMN_TO_MATCH_SELECTED",showSearch:!0,value:void 0},{addItemButtonLabel:"Add Column",componentName:a.componentName.repeaterField,fieldsMetaData:[{componentName:a.componentName.select,label:n("Column"),name:"column",options:[],required:!0,style:{width:100},value:""},{componentName:a.componentName.mixInput,label:n("Value"),name:"value",required:!0,value:void 0,wrapperClassName:"w-100"}],id:"row-data",label:n("Field Mapping"),onChange:"ON_CHANGE_ROW_DATA",path:"rowData",render:"IF_COLUMN_TO_MATCH_SELECTED",value:[]}]},actions:{CONNECTION_ADD_CHANGE:({$:e,e:t})=>{e.setThisComponent(o=>{if(e.util.isConnectionComponent(o))for(const i of o.connectionsTypes)i.type==="oauth2"&&(i.authCodeEndpoint.queryParams&&(i.authCodeEndpoint.queryParams.client_id=t.clientId),i.tokenEndpoint.bodyParams&&(i.tokenEndpoint.bodyParams.client_id=t.clientId,i.tokenEndpoint.bodyParams.client_secret=t.clientSecret))})},IF_CONNECTION_SELECTED:({$:e})=>{var t;return s((t=e.getComponent("connection-id"))==null?void 0:t.value)},IF_COLUMN_TO_MATCH_SELECTED:({$:e})=>{var t;return s((t=e.getComponent("contains-header-row"))==null?void 0:t.value)},IF_CONTAINS_HEADER_ROW_SELECTED:({$:e})=>{var t;return s((t=e.getComponent("column-to-match-on"))==null?void 0:t.value)},IF_SHEET_SELECTED:({$:e})=>{var t;return s((t=e.getComponent("sheet-title"))==null?void 0:t.value)},IF_SPREADSHEET_SELECTED:({$:e})=>{var t;return s((t=e.getComponent("spreadsheet-id"))==null?void 0:t.value)},ON_CHANGE_ROW_DATA:({$:e,e:t})=>{e.setThisComponent(o=>{o.value=t}),e.setDb(o=>{o.rowData=t})},ON_MACHINE_LOAD:async({$:e})=>{h(e,[{db:"connectionId",id:"connection-id"},{db:"spreadsheetId",id:"spreadsheet-id"},{db:"sheetTitle",id:"sheet-title"},{db:"containsHeaderRow",id:"contains-header-row"},{db:"columnToMatch",id:"column-to-match-on"},{db:"rowData",id:"row-data"}]),await Promise.all([d(e),r(e),c(e),l(e)])},REFETCH_SHEETS:async({$:e})=>{await Promise.all([r(e),c(e)])},REFETCH_HEADER_ROW:async({$:e})=>{await Promise.all([c(e),l(e)])},REFETCH_SPREADSHEETS:async({$:e})=>{await d(e)},SET_CONTAINS_HEADER_ROW:async({$:e,e:t})=>{e.setThisComponent(o=>{o.value=t}),e.setDb(o=>{o.containsHeaderRow=t}),await c(e)},SELECT_COLUMN_TO_MATCH:async({$:e,e:t})=>{e.setThisComponent(o=>{o.value=t}),e.setDb(o=>{o.columnToMatch=t}),await l(e)},SELECT_SHEET:async({$:e,e:t})=>{e.setThisComponent(o=>{o.value=t}),e.setComponent("column-to-match-on",o=>{o.value=void 0}),e.setComponent("contains-header-row",o=>{o.value=void 0}),e.setDb(o=>{o.sheetTitle=t,o.columnToMatch=void 0,o.containsHeaderRow=void 0}),await Promise.all([c(e),l(e)])},SELECT_SPREADSHEET:async({$:e,e:t})=>{e.setThisComponent(o=>{o.value=t}),e.setComponent("sheet-title",o=>{o.value=void 0}),e.setComponent("column-to-match-on",o=>{o.value=void 0}),e.setComponent("contains-header-row",o=>{o.value=void 0}),e.setDb(o=>{o.spreadsheetId=t,o.sheetTitle=void 0,o.columnToMatch=void 0,o.containsHeaderRow=void 0}),await r(e)},SET_CONNECTION:async({$:e,e:t})=>{e.setThisComponent(o=>{o.value=t}),e.setComponent("column-to-match-on",o=>{o.value=void 0}),e.setDb(o=>{o.connectionId=t,o.columnToMatch=void 0}),await d(e),p(e,a)}}}));export{w as default};
