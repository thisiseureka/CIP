import{a3 as r}from"./_applist-952.js";import{aH as l,_ as n}from"./main-red-poems-invite.js";import{s as h}from"./machine.-578.js";import"./lodash-840.js";import"./mutative-12.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const d=async t=>l("pro_wordpress-core/get-posts",{postType:t}),m=async()=>l("pro_wordpress-core/get-post-types");globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const p=async t=>{t.setComponent("post-type",o=>{o.loading=!0});const{data:e,status:s}=await m();if(s==="error"){t.setComponent("post-type",o=>{t.util.isSelectComponent(o)&&(o.status=s,o.loading=!1,o.invalidMessage=JSON.stringify(e))}),console.error("Failed to fetch post types");return}t.setComponent("post-type",o=>{t.util.isSelectComponent(o)&&(o.options=e,o.loading=!1,o.status=void 0)})},i=async t=>{var c;t.setComponent("post-id",a=>{a.loading=!0});const e=(c=t.getComponent("post-type"))==null?void 0:c.value,{data:s,status:o}=await d(e);if(o==="error"){t.setComponent("post-id",a=>{t.util.isSelectComponent(a)&&(a.status=o,a.loading=!1,a.invalidMessage=JSON.stringify(s))}),console.error("Failed to fetch posts");return}t.setComponent("post-id",a=>{t.util.isSelectComponent(a)&&(a.options=s,a.loading=!1,a.status=void 0)})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const y=r(({helpers:t})=>({states:{components:[{componentName:t.componentName.select,fieldType:"config",id:"post-type",label:n("Post Type"),mode:"multiple",onChange:"SELECT_POST_TYPE",onRefetch:"REFETCH_POST_TYPES",optionFilterProp:"label",options:[],placeholder:n("any post type"),render:!0,showSearch:!0,value:void 0},{componentName:t.componentName.select,fieldType:"config",id:"post-id",label:n("Posts"),mode:"multiple",onChange:"SELECT_POST",onRefetch:"REFETCH_POSTS",optionFilterProp:"label",options:[],placeholder:n("any post"),render:!0,showSearch:!0,value:void 0},{componentName:t.componentName.hookListener,fieldType:"config",id:"hook-listener",label:n("Listen Hook"),render:!0}]},actions:{ON_MACHINE_LOAD:async({$:e})=>{h(e,[{db:"postType",id:"post-type"},{db:"postId",id:"post-id"}]),await Promise.all([p(e),i(e)])},REFETCH_POST_TYPES:async({$:e})=>p(e),REFETCH_POSTS:async({$:e})=>i(e),SELECT_POST:async({$:e,e:s})=>{e.setThisComponent(o=>{o.value=s}),e.setDb(o=>{o.postId=s})},SELECT_POST_TYPE:async({$:e,e:s})=>{e.setThisComponent(o=>{o.value=s}),e.setDb(o=>{o.postType=s}),e.setComponent("post-id",o=>{o.value=void 0}),await i(e)}}}));export{y as default};
