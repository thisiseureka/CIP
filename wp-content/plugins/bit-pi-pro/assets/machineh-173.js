import{_ as h,dx as r}from"./main-red-poems-invite.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,o){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,o),o)}};const b=e=>({addConnectionHelpingText:h('You can find API guides <a target="_blank" class="text-blue-600 underline" rel="noopener noreferrer nofollow" href="https://developers.hubspot.com/docs/guides/api/overview">Here</a>'),componentName:e.componentName.connection,connectionsTypes:[{encryptKeys:["value"],label:h("Api Key"),showKey:!1,type:"api_key",verifyConnection:{headers:{Authorization:""},method:"GET",responseKeyMatch:["results"],url:"https://api.hubapi.com/crm/v3/objects/contact"}}],fieldType:"config",id:"connection-id",label:h("Select Connection"),onConnectionAddChange:"CONNECTION_ADD_CHANGE",onConnectionChange:"SET_CONNECTION",render:!0,value:void 0}),w=({$:e,e:o})=>{e.setThisComponent(s=>{e.util.isConnectionComponent(s)&&s.connectionsTypes.forEach(n=>{var a;n.type==="api_key"&&((a=n.verifyConnection)!=null&&a.headers)&&o.value&&(n.verifyConnection.headers.Authorization="Bearer "+o.value)})})},A=e=>({$:o,e:s})=>{o.setThisComponent(n=>{n.value=s}),o.setDb(n=>{n[e]=s})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,o){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,o),o)}};const d="https://api.hubapi.com",m=e=>r({headers:{Authorization:["Bearer ",{encryption:"hmac_decrypt",value:e}]},method:"GET",url:`${d}/crm/v3/properties/contacts`}),p=e=>r({headers:{Authorization:["Bearer ",{encryption:"hmac_decrypt",value:e}]},method:"GET",url:`${d}/contacts/v1/lists/static`}),f=(e,o)=>r({headers:{Authorization:["Bearer ",{encryption:"hmac_decrypt",value:e}]},method:"GET",url:`${d}/crm/v3/objects/companies?limit=10&after=${o}`}),C=e=>r({headers:{Authorization:["Bearer ",{encryption:"hmac_decrypt",value:e}]},method:"GET",url:`${d}/crm/v3/properties/companies`}),g=e=>r({headers:{Authorization:["Bearer ",{encryption:"hmac_decrypt",value:e}]},method:"GET",url:`${d}/crm/v3/owners/`}),y=(e,o)=>r({headers:{Authorization:["Bearer ",{encryption:"hmac_decrypt",value:e}]},method:"GET",url:`${d}/crm/v3/objects/deals?limit=10&after=${o}`});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,o){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,o),o)}};let c=0;const T=async e=>{e.setComponent("contact-field-list",n=>{n.loading=!0});const o=await e.getConnection();if(!o){e.setComponent("contact-field-list",n=>{n.loading=!1});return}const{data:s}=await m(o.auth_details.value);e.setComponent("contact-field-list",n=>{if(!e.util.isRepeaterFieldComponent(n))return;const a=n.fieldsMetaData[0],i=new Set(["hs_lead_status","hs_role","hs_seniority","hs_sub_role","lifecyclestage","numemployees"]),l=s.results.filter(t=>t.formField===!0&&!i.has(t.name)).map(t=>({label:t.label,value:t.name}));a.options=l,n.loading=!1})},E=async e=>{e.setComponent("company-field-list",n=>{n.loading=!0});const o=await e.getConnection();if(!o){e.setComponent("company-field-list",n=>{n.loading=!1});return}const{data:s}=await C(o.auth_details.value);e.setComponent("company-field-list",n=>{if(!e.util.isRepeaterFieldComponent(n))return;const a=n.fieldsMetaData[0],i=new Set(["hs_lead_status","lifecyclestage","type"]),l=s.results.filter(t=>t.formField===!0&&!i.has(t.name)).map(t=>({label:t.label,value:t.name}));a.options=l,n.loading=!1})},v=async e=>{e.setComponent("list-id",a=>{a.loading=!0});const o=await e.getConnection();if(!o){e.setComponent("list-id",a=>{a.loading=!1});return}const{data:s,status:n}=await p(o.auth_details.value);if(n!=="success"){e.setComponent("list-id",a=>{e.util.isSelectComponent(a)&&(a.loading=!1,a.status=n,a.invalidMessage=s)}),console.error("Failed to fetch contact list");return}e.setComponent("list-id",a=>{e.util.isSelectComponent(a)&&(a.options=s.lists.map(i=>({label:i.name,value:i.listId})),a.loading=!1)})},S=async(e,o=0)=>{var l;e.setComponent("company-id",t=>{t.loading=!0});const s=await e.getConnection();if(!s){e.setComponent("company-id",t=>{t.loading=!1});return}o===0&&(c=o);const{data:n,status:a}=await f(s.auth_details.value,c);if(a!=="success"){e.setComponent("company-id",t=>{e.util.isSelectComponent(t)&&(t.loading=!1,t.status=a,t.invalidMessage=n)}),console.error("Failed to fetch company");return}if(n.results.length===0){e.setComponent("company-id",t=>{t.loading=!1});return}const i=n.results.map(t=>({label:t.properties.name,value:t.id}));c=Number((l=n.results.at(-1))==null?void 0:l.id)+1,e.setComponent("company-id",t=>{var u;e.util.isSelectComponent(t)&&(t.options=o>0?(u=t.options)==null?void 0:u.concat(i):i,t.loading=!1)})},F=async e=>{e.setComponent("owner-id",a=>{a.loading=!0});const o=await e.getConnection();if(!o){e.setComponent("owner-id",a=>{a.loading=!1});return}const{data:s,status:n}=await g(o.auth_details.value);if(n!=="success"){e.setComponent("owner-id",a=>{e.util.isSelectComponent(a)&&(a.loading=!1,a.status=n,a.invalidMessage=s)}),console.error("Failed to fetch owners");return}e.setComponent("owner-id",a=>{e.util.isSelectComponent(a)&&(a.options=s.results.map(i=>({label:i.email,value:i.id})),a.loading=!1)})},M=async(e,o=0)=>{var l;e.setComponent("deal-id",t=>{t.loading=!0});const s=await e.getConnection();if(!s){e.setComponent("deal-id",t=>{t.loading=!1});return}o===0&&(c=o);const{data:n,status:a}=await y(s.auth_details.value,c);if(a!=="success"){e.setComponent("deal-id",t=>{e.util.isSelectComponent(t)&&(t.loading=!1,t.status=a,t.invalidMessage=n)}),console.error("Failed to fetch deals");return}if(n.results.length===0){e.setComponent("deal-id",t=>{t.loading=!1});return}const i=n==null?void 0:n.results.map(t=>({label:t.properties.dealname,value:t.id}));c=Number((l=n.results.at(-1))==null?void 0:l.id)+1,e.setComponent("deal-id",t=>{var u;e.util.isSelectComponent(t)&&(t.options=o>0?(u=t.options)==null?void 0:u.concat(i):i,t.loading=!1)})};export{A as a,E as b,b as c,S as d,T as e,v as f,F as g,w as h,M as i};
