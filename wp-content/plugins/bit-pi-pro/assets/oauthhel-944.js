import{h as i,aF as p,y as d,dx as g}from"./main-red-poems-invite.js";import{c as b}from"./mutative-12.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};function m(e,a){const o=i(a);o.debugLabel="baseAtom";const t=new Set,r=new BroadcastChannel(e);r.onmessage=s=>{for(const n of t)n(s)};const h=i(s=>s(o),(s,n,c)=>{n(o,c.value),c.isEvent||r.postMessage(s(o))});h.debugLabel="broadcastAtom",h.onMount=s=>{const n=c=>{s({isEvent:!0,value:c.data})};return t.add(n),()=>{t.delete(n)}};const l=i(s=>s(h),(s,n,c)=>{n(h,{isEvent:!1,value:c})});return l.debugLabel="returnedAtom",l}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const u=m("shareOauthInfo",{});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,a){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,a),a)}};const f=p(),A=f.get,w=f.set,C=({queryParams:e,url:a})=>{const o=new URL(a);return e&&(Object.entries(e).forEach(([t,r])=>o.searchParams.append(t,String(r))),o.searchParams.append("state",d.PLUGIN_ADMIN_URL+"/auth-response/"),o.searchParams.append("redirect_uri",d.REDIRECT_URI)),o},I=(e,a)=>{if(e.type!=="oauth2"||!e.authCodeEndpoint)return console.error("Auth code endpoint is not defined"),!1;const o=window.open(C(e.authCodeEndpoint),e.label,"width=500,height=600,toolbar=off"),t=setInterval(()=>{o!=null&&o.closed&&(clearInterval(t),Object.keys(A(u)).length===0&&a(!1))},1e3)},v=async(e,a)=>{if(e.type!=="oauth2"||!e.tokenEndpoint||!e.tokenEndpoint.bodyParams)return console.error("Token endpoint or body params is not defined"),!1;const o=b(e.tokenEndpoint,r=>{r.bodyParams&&(r.bodyParams.redirect_uri=d.REDIRECT_URI,r.bodyParams.code=decodeURIComponent(a.code))}),t=await g(o);return t.status==="error"||!(t!=null&&t.data)||"error"in t.data?(console.error(t==null?void 0:t.data),!1):t==null?void 0:t.data},U=()=>{const e={},a=new URLSearchParams(window.location.hash);for(const[o,t]of a)t&&(e[o]=t);w(u,e),window.close()};export{u as $,I as c,v as g,U as s};
