import{a3 as E,a4 as r}from"./_applist-952.js";import{dx as d,_ as s}from"./main-red-poems-invite.js";import{s as v}from"./machine.-578.js";import"./lodash-840.js";import"./mutative-12.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const T=async t=>d({headers:{Authorization:["Bearer ",{encryption:"hmac_decrypt",value:t}]},method:"GET",url:"https://app.asana.com/api/1.0/projects"}),g=async(t,e)=>d({headers:{Authorization:["Bearer ",{encryption:"hmac_decrypt",value:t}]},method:"GET",url:`https://app.asana.com/api/1.0/projects/${e}/sections`}),_=async(t,e)=>d({headers:{Authorization:["Bearer ",{encryption:"hmac_decrypt",value:t}]},method:"GET",url:`https://app.asana.com/api/1.0/projects/${e}/tasks`}),f=async t=>d({headers:{Authorization:["Bearer ",{encryption:"hmac_decrypt",value:t}]},method:"GET",url:"https://app.asana.com/api/1.0/tags"}),S=async(t,e)=>d({headers:{Authorization:["Bearer ",{encryption:"hmac_decrypt",value:t}]},method:"GET",url:`https://app.asana.com/api/1.0/projects/${e}/custom_field_settings`});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const b=(t,e)=>{const o=t.getComponent("project-id");!e.isSelectComponent(o)||!o.value||!o.options||o.options.some(n=>n.value===o.value)||(t.setComponent("project-id",n=>{n.value=void 0}),t.setDb(n=>{n.projectId=void 0}))},y=(t,e)=>{const o=t.getComponent("section-id"),n=t.getComponent("task-id"),i=t.getComponent("tag-id");!e.isSelectComponent(o)||!o.value||!o.options||o.options.some(a=>a.value===o.value)||!e.isSelectComponent(n)||!n.value||!n.options||n.options.some(a=>a.value===n.value)||!e.isSelectComponent(i)||!i.value||!i.options||i.options.some(a=>a.value===i.value)||(t.setComponent("section-id",a=>{a.value=void 0}),t.setComponent("task-id",a=>{a.value=void 0}),t.setComponent("tag-id",a=>{a.value=void 0}),t.setDb(a=>{a.sectionId=void 0}),t.setDb(a=>{a.taskId=void 0}),t.setDb(a=>{a.tagId=void 0}))},p=async t=>{t.setComponent("project-id",i=>{i.loading=!0});const e=await t.getConnection();if(!e){t.setComponent("project-id",i=>{i.loading=!1});return}const{data:o,status:n}=await T(e.auth_details.token);if(n==="error"){t.setComponent("project-id",i=>{t.util.isSelectComponent(i)&&(i.status=n,i.invalidMessage=o)}),console.error("Failed to fetch projects");return}t.setComponent("project-id",i=>{var a;t.util.isSelectComponent(i)&&(i.options=(a=o==null?void 0:o.data)==null?void 0:a.map(c=>({label:c.name,value:c.gid})),i.loading=!1,i.status=void 0)})},u=async t=>{var i;t.setComponent("section-id",a=>{a.loading=!0});const e=await t.getConnection();if(!e){t.setComponent("section-id",a=>{a.loading=!1});return}const{data:o,status:n}=await g(e.auth_details.token,(i=t.getComponent("project-id"))==null?void 0:i.value);if(n==="error"){t.setComponent("section-id",a=>{t.util.isSelectComponent(a)&&(a.status=n,a.invalidMessage=o)}),console.error("Failed to fetch sections");return}t.setComponent("section-id",a=>{var c;t.util.isSelectComponent(a)&&(a.options=(c=o==null?void 0:o.data)==null?void 0:c.map(l=>({label:l.name,value:l.gid})),a.loading=!1,a.status=void 0)})},m=async t=>{var i;t.setComponent("task-id",a=>{a.loading=!0});const e=await t.getConnection();if(!e){t.setComponent("task-id",a=>{a.loading=!1});return}const{data:o,status:n}=await _(e.auth_details.token,(i=t.getComponent("project-id"))==null?void 0:i.value);if(n==="error"){t.setComponent("task-id",a=>{t.util.isSelectComponent(a)&&(a.status=n,a.invalidMessage=o)}),console.error("Failed to fetch tasks");return}t.setComponent("task-id",a=>{var c;t.util.isSelectComponent(a)&&(a.options=(c=o==null?void 0:o.data)==null?void 0:c.map(l=>({label:l.name,value:l.gid})),a.loading=!1,a.status=void 0)})},C=async t=>{t.setComponent("tag-id",i=>{i.loading=!0});const e=await t.getConnection();if(!e){t.setComponent("tag-id",i=>{i.loading=!1});return}const{data:o,status:n}=await f(e.auth_details.token);if(n==="error"){t.setComponent("tag-id",i=>{t.util.isSelectComponent(i)&&(i.status=n,i.invalidMessage=o)}),console.error("Failed to fetch tags");return}t.setComponent("tag-id",i=>{var a;t.util.isSelectComponent(i)&&(i.options=(a=o==null?void 0:o.data)==null?void 0:a.map(c=>({label:c.name,value:c.gid})),i.loading=!1,i.status=void 0)})},N=t=>{const e=[{label:s("Name"),value:"name"},{label:s("Notes"),value:"notes"},{label:s("Approval Status"),value:"approval_status"},{label:s("Start At"),value:"start_at"},{label:s("Start On"),value:"start_on"},{label:s("Due At"),value:"due_at"},{label:s("Due On"),value:"due_on"},{label:s("Completed"),value:"completed"}];return Array.isArray(t==null?void 0:t.data)?t.data.forEach(o=>{var n,i;(n=o==null?void 0:o.custom_field)!=null&&n.name&&((i=o==null?void 0:o.custom_field)!=null&&i.gid)?e.push({label:o.custom_field.name,value:o.custom_field.gid}):console.warn("Invalid field encountered:",o)}):console.warn("No customFields found in data or customFields is not an array."),e},h=async t=>{var n;t.setComponent("task-data",i=>{i.loading=!0});const e=await t.getConnection();if(!e){t.setComponent("task-data",i=>{i.loading=!1});return}const{data:o}=await S(e.auth_details.token,(n=t.getComponent("project-id"))==null?void 0:n.value);t.setComponent("task-data",i=>{if(!t.util.isRepeaterFieldComponent(i))return;const a=i.fieldsMetaData[0];a.options=N(o),i.loading=!1})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const F=E(({helpers:t})=>({states:{components:[{addConnectionHelpingText:s('You can get your API key from <a class="text-blue-600 underline" href="https://app.asana.com/0/my-apps" target="_blank" rel="noopener noreferrer nofollow">here</a>'),componentName:t.componentName.connection,connectionsTypes:[{encryptKeys:["token"],label:s("Bearer Token"),type:"bearer_token",verifyConnection:{headers:{Authorization:""},method:"GET",responseKeyMatch:["data"],url:"https://app.asana.com/api/1.0/users/me"}}],fieldType:"config",id:"connection-id",label:s("Select Connection"),onConnectionAddChange:"CONNECTION_ADD_CHANGE",onConnectionChange:"SET_CONNECTION",render:!0,value:void 0},{componentName:t.componentName.select,fieldType:"config",id:"project-id",label:s("Projects"),onChange:"SELECT_PROJECT",onRefetch:"REFETCH_PROJECT",optionFilterProp:"label",options:[],placeholder:s("Select a project"),render:"IF_CONNECTION_SELECTED",showSearch:!0,value:void 0},{componentName:t.componentName.select,fieldType:"config",id:"section-id",label:s("Sections"),onChange:"SELECT_SECTION",onRefetch:"REFETCH_SECTION",optionFilterProp:"label",options:[],placeholder:s("Select a section"),render:"IF_PROJECT_SELECTED",showSearch:!0,value:void 0},{componentName:t.componentName.select,fieldType:"config",id:"task-id",label:s("Tasks"),onChange:"SELECT_TASK",onRefetch:"REFETCH_TASK",optionFilterProp:"label",options:[],placeholder:s("Select a task"),render:"IF_PROJECT_SELECTED",showSearch:!0,value:void 0},{componentName:t.componentName.select,fieldType:"config",id:"tag-id",label:s("Tags"),onChange:"SELECT_TAG",onRefetch:"REFETCH_TAG",optionFilterProp:"label",options:[],placeholder:s("Select a tag"),render:"IF_PROJECT_SELECTED",showSearch:!0,value:void 0},{addItemButtonLabel:"Add Column",componentName:t.componentName.repeaterField,fieldsMetaData:[{componentName:t.componentName.select,label:s("Column"),name:"column",options:[],required:!0,showSearch:!0,style:{width:200},value:""},{componentName:t.componentName.mixInput,label:s("Value"),name:"value",required:!0,value:[],wrapperClassName:"w-100"}],id:"task-data",label:s("Field Mapping"),nonRemovableRows:[0],onChange:"ON_CHANGE_ROW_DATA",path:"rowData",render:"IF_PROJECT_SELECTED",value:[[{disabled:!0,name:"column",value:"name"},{name:"value",value:[]}]]}]},actions:{CONNECTION_ADD_CHANGE:({$:e,e:o})=>{e.setThisComponent(n=>{e.util.isConnectionComponent(n)&&n.connectionsTypes.forEach(i=>{var a;i.type==="bearer_token"&&((a=i.verifyConnection)!=null&&a.headers)&&(i.verifyConnection.headers.Authorization="Bearer "+o.token)})})},IF_CONNECTION_SELECTED:({$:e})=>{var o;return r((o=e.getComponent("connection-id"))==null?void 0:o.value)},IF_PROJECT_SELECTED:({$:e})=>{var o;return r((o=e.getComponent("project-id"))==null?void 0:o.value)},IF_SECTION_SELECTED:({$:e})=>{var o;return r((o=e.getComponent("section-id"))==null?void 0:o.value)},IF_TASK_SELECTED:({$:e})=>{var o;return r((o=e.getComponent("task-id"))==null?void 0:o.value)},IF_TAG_SELECTED:({$:e})=>{var o;return r((o=e.getComponent("tag-id"))==null?void 0:o.value)},ON_CHANGE_ROW_DATA:({$:e,e:o})=>{e.setThisComponent(n=>{n.value=o}),e.setDb(n=>{n.rowData=o})},ON_MACHINE_LOAD:async({$:e})=>{v(e,[{db:"connectionId",id:"connection-id"},{db:"projectId",id:"project-id"},{db:"sectionId",id:"section-id"},{db:"taskId",id:"task-id"},{db:"tagId",id:"tag-id"},{db:"rowData",id:"task-data"}]),await Promise.all([p(e),u(e),m(e),C(e),h(e)])},REFETCH_SECTION:async({$:e})=>{await u(e)},REFETCH_PROJECT:async({$:e})=>{await p(e)},REFETCH_TASK:async({$:e})=>{await m(e)},REFETCH_TAG:async({$:e})=>{await C(e)},SELECT_TAG:async({$:e,e:o})=>{e.setThisComponent(n=>{n.value=o}),e.setComponent("tag-title",n=>{n.value=void 0}),e.setDb(n=>{n.tagId=o,n.tagTitle=void 0})},SELECT_TASK:async({$:e,e:o})=>{e.setThisComponent(n=>{n.value=o}),e.setComponent("task-title",n=>{n.value=void 0}),e.setDb(n=>{n.taskId=o,n.taskTitle=void 0})},SELECT_SECTION:async({$:e,e:o})=>{e.setThisComponent(n=>{n.value=o}),e.setComponent("section-title",n=>{n.value=void 0}),e.setDb(n=>{n.sectionId=o,n.sectionTitle=void 0})},SELECT_PROJECT:async({$:e,e:o})=>{e.setThisComponent(n=>{n.value=o}),e.setComponent("project-title",n=>{n.value=void 0}),e.setDb(n=>{n.projectId=o,n.projectTitle=void 0}),await u(e),await m(e),await C(e),await h(e),y(e,t)},SET_CONNECTION:async({$:e,e:o})=>{e.setThisComponent(n=>{n.value=o}),e.setDb(n=>{n.connectionId=o}),await p(e),b(e,t)}}}));export{F as default};
