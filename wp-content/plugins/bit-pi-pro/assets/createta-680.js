import{a3 as v,a4 as d}from"./_applist-952.js";import{dx as r,_ as s}from"./main-red-poems-invite.js";import{s as E}from"./machine.-578.js";import"./lodash-840.js";import"./mutative-12.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const f=async t=>r({headers:{Authorization:{encryption:"hmac_decrypt",value:t}},method:"GET",url:"https://api.clickup.com/api/v2/team"}),T=async(t,e)=>r({headers:{Authorization:{encryption:"hmac_decrypt",value:t}},method:"GET",url:`https://api.clickup.com/api/v2/team/${e}/space`}),_=async(t,e)=>r({headers:{Authorization:{encryption:"hmac_decrypt",value:t}},method:"GET",url:`https://api.clickup.com/api/v2/space/${e}/folder`}),g=async(t,e)=>r({headers:{Authorization:{encryption:"hmac_decrypt",value:t}},method:"GET",url:`https://api.clickup.com/api/v2/folder/${e}/list`}),b=async(t,e)=>r({headers:{Authorization:{encryption:"hmac_decrypt",value:t}},method:"GET",url:`https://api.clickup.com/api/v2/list/${e}/field`});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const S=(t,e)=>{const o=t.getComponent("team-id");!e.isSelectComponent(o)||!o.value||!o.options||o.options.some(n=>n.value===o.value)||(t.setComponent("team-id",n=>{n.value=void 0,n.label=void 0}),t.setDb(n=>{n.teamId=void 0}))},y=(t,e)=>{const o=t.getComponent("space-id");!e.isSelectComponent(o)||!o.value||!o.options||o.options.some(n=>n.value===o.value)||(t.setComponent("space-id",n=>{n.value=void 0,n.label=void 0}),t.setDb(n=>{n.spaceId=void 0}))},D=(t,e)=>{const o=t.getComponent("folder-id");!e.isSelectComponent(o)||!o.value||!o.options||o.options.some(n=>n.value===o.value)||(t.setComponent("folder-id",n=>{n.value=void 0,n.label=void 0}),t.setDb(n=>{n.folderId=void 0}))},N=(t,e)=>{const o=t.getComponent("list-id");!e.isSelectComponent(o)||!o.value||!o.options||o.options.some(n=>n.value===o.value)||(t.setComponent("list-id",n=>{n.value=void 0,n.label=void 0}),t.setDb(n=>{n.listId=void 0}))},A=(t,e)=>{const o=t.getComponent("task-data");!e.isSelectComponent(o)||!o.value||!o.options||o.options.some(n=>n.value===o.value)||(t.setComponent("task-data",n=>{n.value=void 0,n.label=void 0}),t.setDb(n=>{n.rowId=void 0}))},u=async t=>{t.setComponent("team-id",i=>{i.loading=!0});const e=await t.getConnection();if(!e){t.setComponent("team-id",i=>{i.loading=!1});return}const{data:o,status:n}=await f(e.auth_details.value);if(n==="error"){t.setComponent("team-id",i=>{t.util.isSelectComponent(i)&&(i.status=n,i.invalidMessage=o)}),console.error("Failed to fetch teams");return}t.setComponent("team-id",i=>{var a;t.util.isSelectComponent(i)&&(i.options=(a=o==null?void 0:o.teams)==null?void 0:a.map(l=>({label:l.name,value:l.id})),i.loading=!1,i.status=void 0)})},p=async t=>{var i;t.setComponent("space-id",a=>{a.loading=!0});const e=await t.getConnection();if(!e){t.setComponent("space-id",a=>{a.loading=!1});return}const{data:o,status:n}=await T(e.auth_details.value,(i=t.getComponent("team-id"))==null?void 0:i.value);if(n==="error"){t.setComponent("space-id",a=>{t.util.isSelectComponent(a)&&(a.status=n,a.invalidMessage=o)}),console.error("Failed to fetch spaces");return}t.setComponent("space-id",a=>{var l;t.util.isSelectComponent(a)&&(a.options=(l=o==null?void 0:o.spaces)==null?void 0:l.map(c=>({label:c.name,value:c.id})),a.loading=!1,a.status=void 0)})},m=async t=>{var i;t.setComponent("folder-id",a=>{a.loading=!0});const e=await t.getConnection();if(!e){t.setComponent("folder-id",a=>{a.loading=!1});return}const{data:o,status:n}=await _(e.auth_details.value,(i=t.getComponent("space-id"))==null?void 0:i.value);if(n==="error"){t.setComponent("folder-id",a=>{t.util.isSelectComponent(a)&&(a.status=n,a.invalidMessage=o)}),console.error("Failed to fetch folders");return}t.setComponent("folder-id",a=>{var l;t.util.isSelectComponent(a)&&(a.options=(l=o==null?void 0:o.folders)==null?void 0:l.map(c=>({label:c.name,value:c.id})),a.loading=!1,a.status=void 0)})},C=async t=>{var i;t.setComponent("list-id",a=>{a.loading=!0});const e=await t.getConnection();if(!e){t.setComponent("list-id",a=>{a.loading=!1});return}const{data:o,status:n}=await g(e.auth_details.value,(i=t.getComponent("folder-id"))==null?void 0:i.value);if(n==="error"){t.setComponent("list-id",a=>{t.util.isSelectComponent(a)&&(a.status=n,a.invalidMessage=o)}),console.error("Failed to fetch lists");return}t.setComponent("list-id",a=>{var l;t.util.isSelectComponent(a)&&(a.options=(l=o==null?void 0:o.lists)==null?void 0:l.map(c=>({label:c.name,value:c.id})),a.loading=!1,a.status=void 0)})},F=t=>{const e=[{label:s("Name"),value:"name"},{label:s("Description"),value:"description"},{label:s("Status"),value:"status"},{label:s("Priority"),value:"priority"},{label:s("Due Date"),value:"due_date"},{label:s("Due Date Time"),value:"due_date_time"},{label:s("Time Estimate"),value:"time_estimate"},{label:s("Start Date"),value:"start_date"},{label:s("Start Date Time"),value:"start_date_time"},{label:s("Points"),value:"points"},{label:s("Notify All"),value:"notify_all"}];return Array.isArray(t==null?void 0:t.fields)?t.fields.forEach(o=>{o!=null&&o.name&&(o!=null&&o.id)?e.push({label:o.name,value:o.id}):console.warn("Invalid field encountered:",o)}):console.warn("No customFields found in data or customFields is not an array."),e},h=async t=>{var n;t.setComponent("task-data",i=>{i.loading=!0});const e=await t.getConnection();if(!e){t.setComponent("task-data",i=>{i.loading=!1});return}const{data:o}=await b(e.auth_details.value,(n=t.getComponent("list-id"))==null?void 0:n.value);t.setComponent("task-data",i=>{if(!t.util.isRepeaterFieldComponent(i))return;const a=i.fieldsMetaData[0];a.options=F(o),i.loading=!1})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const k=v(({helpers:t})=>({states:{components:[{addConnectionHelpingText:s('You can get your API key from <a class="text-blue-600 underline" href="https://app.clickup.com/" target="_blank" rel="noopener noreferrer nofollow">here</a>'),componentName:t.componentName.connection,connectionsTypes:[{encryptKeys:["value"],label:s("API Key"),showKey:!1,type:"api_key",verifyConnection:{headers:{Authorization:""},method:"GET",responseKeyMatch:["user"],url:"https://api.clickup.com/api/v2/user"}}],fieldType:"config",id:"connection-id",label:s("Select Connection"),onConnectionAddChange:"CONNECTION_ADD_CHANGE",onConnectionChange:"SET_CONNECTION",render:!0,value:void 0},{componentName:t.componentName.select,fieldType:"config",id:"team-id",label:s("Teams"),onChange:"SELECT_TEAM",onRefetch:"REFETCH_TEAM",optionFilterProp:"label",options:[],placeholder:s("Select a team"),render:"IF_CONNECTION_SELECTED",showSearch:!0,value:void 0},{componentName:t.componentName.select,fieldType:"config",id:"space-id",label:s("Spaces"),onChange:"SELECT_SPACE",onRefetch:"REFETCH_SPACE",optionFilterProp:"label",options:[],placeholder:s("Select a space"),render:"IF_TEAM_SELECTED",showSearch:!0,value:void 0},{componentName:t.componentName.select,fieldType:"config",id:"folder-id",label:s("Folders"),onChange:"SELECT_FOLDER",onRefetch:"REFETCH_FOLDER",optionFilterProp:"label",options:[],placeholder:s("Select a folder"),render:"IF_SPACE_SELECTED",showSearch:!0,value:void 0},{componentName:t.componentName.select,fieldType:"config",id:"list-id",label:s("Lists"),onChange:"SELECT_LIST",onRefetch:"REFETCH_LIST",optionFilterProp:"label",options:[],placeholder:s("Select a list"),render:"IF_FOLDER_SELECTED",showSearch:!0,value:void 0},{addItemButtonLabel:"Add Column",componentName:t.componentName.repeaterField,fieldsMetaData:[{componentName:t.componentName.select,label:s("Column"),name:"column",options:[],required:!0,showSearch:!0,style:{width:200},value:""},{componentName:t.componentName.mixInput,label:s("Value"),name:"value",required:!0,value:[],wrapperClassName:"w-100"}],id:"task-data",label:s("Field Mapping"),nonRemovableRows:[0],onChange:"ON_CHANGE_ROW_DATA",path:"rowData",render:"IF_LIST_SELECTED",value:[[{disabled:!0,name:"column",value:"name"},{name:"value",value:[]}]]}]},actions:{CONNECTION_ADD_CHANGE:({$:e,e:o})=>{e.setThisComponent(n=>{e.util.isConnectionComponent(n)&&n.connectionsTypes.forEach(i=>{var a;i.type==="api_key"&&((a=i.verifyConnection)!=null&&a.headers)&&(i.verifyConnection.headers.Authorization=o.value)})})},IF_CONNECTION_SELECTED:({$:e})=>{var o;return d((o=e.getComponent("connection-id"))==null?void 0:o.value)},IF_TEAM_SELECTED:({$:e})=>{var o;return d((o=e.getComponent("team-id"))==null?void 0:o.value)},IF_SPACE_SELECTED:({$:e})=>{var o;return d((o=e.getComponent("space-id"))==null?void 0:o.value)},IF_FOLDER_SELECTED:({$:e})=>{var o;return d((o=e.getComponent("folder-id"))==null?void 0:o.value)},IF_LIST_SELECTED:({$:e})=>{var o;return d((o=e.getComponent("list-id"))==null?void 0:o.value)},ON_CHANGE_ROW_DATA:({$:e,e:o})=>{e.setThisComponent(n=>{n.value=o}),e.setDb(n=>{n.rowData=o})},ON_MACHINE_LOAD:async({$:e})=>{E(e,[{db:"connectionId",id:"connection-id"},{db:"teamId",id:"team-id"},{db:"spaceId",id:"space-id"},{db:"folderId",id:"folder-id"},{db:"listId",id:"list-id"},{db:"rowData",id:"task-data"}]),await Promise.all([u(e),p(e),m(e),C(e),h(e)])},REFETCH_SPACE:async({$:e})=>{await p(e)},REFETCH_TEAM:async({$:e})=>{await u(e)},REFETCH_FOLDER:async({$:e})=>{await m(e)},REFETCH_LIST:async({$:e})=>{await C(e)},SELECT_LIST:async({$:e,e:o})=>{e.setThisComponent(n=>{n.value=o}),e.setComponent("list-title",n=>{n.value=void 0}),e.setDb(n=>{n.listId=o,n.listTitle=void 0}),await h(e),A(e,t)},SELECT_FOLDER:async({$:e,e:o})=>{e.setThisComponent(n=>{n.value=o}),e.setComponent("folder-title",n=>{n.value=void 0}),e.setDb(n=>{n.folderId=o,n.folderTitle=void 0}),await C(e),N(e,t)},SELECT_SPACE:async({$:e,e:o})=>{e.setThisComponent(n=>{n.value=o}),e.setComponent("space-title",n=>{n.value=void 0}),e.setDb(n=>{n.spaceId=o,n.spaceTitle=void 0}),await m(e),D(e,t)},SELECT_TEAM:async({$:e,e:o})=>{e.setThisComponent(n=>{n.value=o}),e.setComponent("team-title",n=>{n.value=void 0}),e.setDb(n=>{n.teamId=o,n.teamTitle=void 0}),await p(e),y(e,t)},SET_CONNECTION:async({$:e,e:o})=>{e.setThisComponent(n=>{n.value=o}),e.setDb(n=>{n.connectionId=o}),await u(e),S(e,t)}}}));export{k as default};
