import{a3 as d,a4 as c}from"./_applist-952.js";import{dx as m,_ as i}from"./main-red-poems-invite.js";import{s as C}from"./machine.-578.js";import"./lodash-840.js";import"./mutative-12.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const h=async t=>m({method:"GET",queryParams:{api_key:{encryption:"hmac_decrypt",value:t},format:"json"},url:"https://api.selzy.com/en/api/getLists"}),E=async t=>m({method:"GET",queryParams:{api_key:{encryption:"hmac_decrypt",value:t},format:"json"},url:"https://api.selzy.com/en/api/getTags"}),T=async t=>m({method:"GET",queryParams:{api_key:{encryption:"hmac_decrypt",value:t},format:"json"},url:"https://api.selzy.com/en/api/getFields"});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const g=(t,e)=>{const n=t.getComponent("list-id");!e.isSelectComponent(n)||!n.value||!n.options||n.options.some(o=>o.value===n.value)||(t.setComponent("list-id",o=>{o.value=void 0}),t.setDb(o=>{o.listId=void 0}))},r=async t=>{t.setComponent("list-id",a=>{a.loading=!0});const e=await t.getConnection();if(!e){t.setComponent("list-id",a=>{a.loading=!1});return}const{data:n,status:o}=await h(e.auth_details.value);if(o==="error"){t.setComponent("list-id",a=>{t.util.isSelectComponent(a)&&(a.status=o,a.invalidMessage=n)}),console.error("Failed to fetch lists");return}t.setComponent("list-id",a=>{var l;t.util.isSelectComponent(a)&&(a.options=(l=n==null?void 0:n.result)==null?void 0:l.map(s=>({label:s.title,value:s.id})),a.loading=!1,a.status=void 0)})},u=async t=>{t.setComponent("tag-id",a=>{a.loading=!0});const e=await t.getConnection();if(!e){t.setComponent("tag-id",a=>{a.loading=!1});return}const{data:n,status:o}=await E(e.auth_details.value);if(o==="error"){t.setComponent("tag-id",a=>{t.util.isSelectComponent(a)&&(a.status=o,a.invalidMessage=n)}),console.error("Failed to fetch tags");return}t.setComponent("tag-id",a=>{var l;t.util.isSelectComponent(a)&&(a.options=(l=n==null?void 0:n.result)==null?void 0:l.map(s=>({label:s.name,value:s.name})),a.loading=!1,a.status=void 0)})},_=t=>{const e=[{label:i("Email"),value:"email"}];return Array.isArray(t==null?void 0:t.result)?t.result.forEach(n=>{n!=null&&n.public_name&&(n!=null&&n.name)?e.push({label:n.public_name,value:n.name}):console.warn("Invalid field encountered:",n)}):console.warn("No ContactFields found in data or ContactFields is not an array."),e},p=async t=>{t.setComponent("contact-data",o=>{o.loading=!0,t.util.isRepeaterFieldComponent(o)&&(o.labelActionLoading=!0)});const e=await t.getConnection();if(!e){t.setComponent("contact-data",o=>{o.loading=!1,t.util.isRepeaterFieldComponent(o)&&(o.labelActionLoading=!1)});return}const{data:n}=await T(e.auth_details.value);t.setComponent("contact-data",o=>{if(!t.util.isRepeaterFieldComponent(o))return;const a=o.fieldsMetaData[0];a.options=_(n),o.loading=!1,t.util.isRepeaterFieldComponent(o)&&(o.labelActionLoading=!1)})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const O=d(({helpers:t})=>({states:{components:[{addConnectionHelpingText:i('You can get your API key from <a class="text-blue-600 underline" href="https://cp.selzy.com/en/v5/user/info/api" target="_blank" rel="noopener noreferrer nofollow">here</a>'),componentName:t.componentName.connection,connectionsTypes:[{encryptKeys:["value"],label:i("API Key"),showKey:!1,type:"api_key",verifyConnection:{headers:{Authorization:""},method:"GET",responseKeyMatch:["result"],url:"https://api.selzy.com/en/api/getUserInfo"}}],fieldType:"config",id:"connection-id",label:i("Select Connection"),onConnectionAddChange:"CONNECTION_ADD_CHANGE",onConnectionChange:"SET_CONNECTION",render:!0,value:void 0},{componentName:t.componentName.select,fieldType:"config",id:"list-id",label:i("Lists"),mode:"multiple",onChange:"SELECT_LIST",onRefetch:"REFETCH_LIST",optionFilterProp:"label",options:[],placeholder:i("Select a list"),render:"IF_CONNECTION_SELECTED",showSearch:!0,value:void 0},{componentName:t.componentName.select,fieldType:"config",id:"tag-id",label:i("Tags"),mode:"multiple",onChange:"SELECT_TAG",onRefetch:"REFETCH_TAG",optionFilterProp:"label",options:[],placeholder:i("Select a tag"),render:"IF_LIST_SELECTED",showSearch:!0,value:void 0},{addItemButtonLabel:"Add Column",componentName:t.componentName.repeaterField,fieldsMetaData:[{componentName:t.componentName.select,label:i("Column"),name:"column",options:[],required:!0,showSearch:!0,style:{width:200},value:""},{componentName:t.componentName.mixInput,label:i("Value"),name:"value",required:!0,value:[],wrapperClassName:"w-100"}],id:"contact-data",label:i("Field Mapping"),labelActionOnClick:"REFETCH_COLUMNS",labelActionText:i("Refetch Columns"),nonRemovableRows:[0],onChange:"ON_CHANGE_ROW_DATA",path:"rowData",render:"IF_LIST_SELECTED",value:[[{disabled:!0,name:"column",value:"email"},{name:"value",value:[]}]]},{componentName:t.componentName.select,fieldType:"config",helperText:i("Override the existing lead info by responses."),id:"override-existing",label:i("Override"),onChange:"HANDLE_OVERRIDE_EXISTING",optionFilterProp:"label",options:[{label:i("No"),value:"0"},{label:i("Overwrite"),value:"1"},{label:i("Override"),value:"2"}],placeholder:i("Select a option"),render:"IF_CONNECTION_SELECTED",value:"0"},{componentName:t.componentName.select,fieldType:"config",helperText:i("Double Optin."),id:"double-optin",label:i("Double Optin"),onChange:"HANDLE_DOUBLE_OPTIN",optionFilterProp:"label",options:[{label:i("Yes"),value:"true"},{label:i("No"),value:"false"}],placeholder:i("Select a option"),render:"IF_CONNECTION_SELECTED",value:"false"}]},actions:{CONNECTION_ADD_CHANGE:({$:e,e:n})=>{e.setThisComponent(o=>{e.util.isConnectionComponent(o)&&o.connectionsTypes.forEach(a=>{a.type==="api_key"&&a.verifyConnection&&(a.verifyConnection.queryParams={api_key:n.value,format:"json"})})})},IF_CONNECTION_SELECTED:({$:e})=>{var n;return c((n=e.getComponent("connection-id"))==null?void 0:n.value)},IF_LIST_SELECTED:({$:e})=>{var n;return c((n=e.getComponent("list-id"))==null?void 0:n.value)},IF_TAG_SELECTED:({$:e})=>{var n;return c((n=e.getComponent("tag-id"))==null?void 0:n.value)},ON_CHANGE_ROW_DATA:({$:e,e:n})=>{e.setThisComponent(o=>{o.value=n}),e.setDb(o=>{o.rowData=n})},ON_MACHINE_LOAD:async({$:e})=>{C(e,[{db:"connectionId",id:"connection-id"},{db:"listId",id:"list-id"},{db:"tagId",id:"tag-id"},{db:"rowData",id:"contact-data"},{db:"overrideExisting",id:"override-existing"},{db:"doubleOptin",id:"double-optin"}]),await Promise.all([r(e),u(e),p(e)])},REFETCH_COLUMNS:async({$:e})=>{await p(e)},REFETCH_LIST:async({$:e})=>{await r(e)},REFETCH_TAG:async({$:e})=>{await u(e)},HANDLE_DOUBLE_OPTIN:({$:e,e:n})=>{e.setThisComponent(o=>{o.value=n}),e.setDb(o=>{o.doubleOptin=n})},HANDLE_OVERRIDE_EXISTING:({$:e,e:n})=>{e.setThisComponent(o=>{o.value=n}),e.setDb(o=>{o.overrideExisting=n})},SELECT_LIST:async({$:e,e:n})=>{e.setThisComponent(o=>{o.value=n}),e.setComponent("list-title",o=>{o.value=void 0}),e.setDb(o=>{o.listId=n,o.listTitle=void 0})},SELECT_TAG:async({$:e,e:n})=>{e.setThisComponent(o=>{o.value=n}),e.setComponent("tag-title",o=>{o.value=void 0}),e.setDb(o=>{o.tagId=n,o.tagTitle=void 0})},SET_CONNECTION:async({$:e,e:n})=>{e.setThisComponent(o=>{o.value=n}),e.setDb(o=>{o.connectionId=n}),g(e,t),Promise.all([r(e),u(e),p(e)])}}}));export{O as default};
