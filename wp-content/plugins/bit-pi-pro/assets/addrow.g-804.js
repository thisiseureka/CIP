import{a3 as d,a4 as c}from"./_applist-952.js";import{_ as n}from"./main-red-poems-invite.js";import{s as p}from"./machine.-578.js";import{f as l,h as E,a as r,s as i}from"./machineh-789.js";import"./lodash-840.js";import"./mutative-12.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(a,e){return this.cache.has(a)?this.cache.get(a):(this.cache.set(a,e),e)}};const S=d(({helpers:a})=>({states:{components:[{addConnectionHelpingText:n("You can find credentials from ")+`<a target="_blank" class="text-blue-600 underline" rel="noopener noreferrer nofollow" href="https://console.cloud.google.com/apis/credentials">${n("Here")}</a>`,componentName:a.componentName.connection,connectionsTypes:[{authCodeEndpoint:{method:"GET",queryParams:{access_type:"offline",client_id:"",prompt:"consent",response_type:"code",scope:"https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.readonly"},url:"https://accounts.google.com/o/oauth2/v2/auth"},encryptKeys:["access_token","refresh_token","client_secret"],label:n("OAuth 2"),refreshTokenUrl:"https://oauth2.googleapis.com/token",tokenEndpoint:{bodyParams:{client_id:"",client_secret:"",grant_type:"authorization_code"},method:"POST",url:"https://oauth2.googleapis.com/token"},type:"oauth2",verifyConnection:{method:"GET",queryParams:{access_token:"$_access_token_$"},responseMatch:{scope:"https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.readonly"},url:"https://www.googleapis.com/oauth2/v2/tokeninfo"}}],fieldType:"config",id:"connection-id",label:n("Select Connection"),onConnectionAddChange:"CONNECTION_ADD_CHANGE",onConnectionChange:"SET_CONNECTION",render:!0,value:void 0},{componentName:a.componentName.select,fieldType:"config",id:"spreadsheet-id",label:n("Spreadsheet"),onChange:"SELECT_SPREADSHEET",onRefetch:"REFETCH_SPREADSHEETS",optionFilterProp:"label",options:[],placeholder:n("Select a spreadsheet"),render:"IF_CONNECTION_SELECTED",showSearch:!0,value:void 0},{componentName:a.componentName.select,fieldType:"config",id:"sheet-title",label:n("Sheet"),onChange:"SELECT_SHEET",onRefetch:"REFETCH_SHEETS",optionFilterProp:"label",options:[],placeholder:n("Select a sheet"),render:"IF_SPREADSHEET_SELECTED",showSearch:!0,value:void 0},{addItemButtonLabel:"Add Column",componentName:a.componentName.repeaterField,fieldsMetaData:[{componentName:a.componentName.select,label:n("Column"),name:"column",options:[],required:!0,style:{width:100},value:""},{componentName:a.componentName.mixInput,label:n("Value"),name:"value",required:!0,value:[],wrapperClassName:"w-100"}],id:"row-data",label:n("Field Mapping"),labelActionIconName:"refresh-cw",labelActionOnClick:"REFETCH_COLUMNS",labelActionText:n("Refetch Columns"),onChange:"ON_CHANGE_ROW_DATA",path:"rowData",render:"IF_SHEET_SELECTED",value:[],wrapperClassName:"mt-3"}]},actions:{CONNECTION_ADD_CHANGE:({$:e,e:t})=>{e.setThisComponent(o=>{if(e.util.isConnectionComponent(o))for(const s of o.connectionsTypes)s.type==="oauth2"&&(s.authCodeEndpoint.queryParams&&(s.authCodeEndpoint.queryParams.client_id=t.clientId),s.tokenEndpoint.bodyParams&&(s.tokenEndpoint.bodyParams.client_id=t.clientId,s.tokenEndpoint.bodyParams.client_secret=t.clientSecret))})},IF_CONNECTION_SELECTED:({$:e})=>{var t;return c((t=e.getComponent("connection-id"))==null?void 0:t.value)},IF_SHEET_SELECTED:({$:e})=>{var t;return c((t=e.getComponent("sheet-title"))==null?void 0:t.value)},IF_SPREADSHEET_SELECTED:({$:e})=>{var t;return c((t=e.getComponent("spreadsheet-id"))==null?void 0:t.value)},ON_CHANGE_ROW_DATA:({$:e,e:t})=>{e.setThisComponent(o=>{o.value=t}),e.setDb(o=>{o.rowData=t})},ON_MACHINE_LOAD:async({$:e})=>{p(e,[{db:"connectionId",id:"connection-id"},{db:"spreadsheetId",id:"spreadsheet-id"},{db:"sheetTitle",id:"sheet-title"},{db:"rowData",id:"row-data"}]),await Promise.all([l(e),r(e),i(e)])},REFETCH_COLUMNS:async({$:e})=>{await i(e)},REFETCH_SHEETS:async({$:e})=>{await Promise.all([r(e),i(e)])},REFETCH_SPREADSHEETS:async({$:e})=>{await l(e)},SELECT_SHEET:async({$:e,e:t})=>{e.setThisComponent(o=>{o.value=t}),e.setDb(o=>{o.sheetTitle=t}),await i(e)},SELECT_SPREADSHEET:async({$:e,e:t})=>{e.setThisComponent(o=>{o.value=t}),e.setComponent("sheet-title",o=>{o.value=void 0}),e.setDb(o=>{o.spreadsheetId=t,o.sheetTitle=void 0}),await r(e)},SET_CONNECTION:async({$:e,e:t})=>{e.setThisComponent(o=>{o.value=t}),e.setDb(o=>{o.connectionId=t}),await l(e),E(e,a)}}}));export{S as default};
