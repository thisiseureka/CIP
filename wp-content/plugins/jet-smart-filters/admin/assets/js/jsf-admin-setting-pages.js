"use strict";function clone(e){if("object"!=typeof e)return e;let t,s,i;t=Array.isArray(e)?[]:{};for(i in e)s=e[i],t[i]="object"==typeof s?clone(s):s;return t}function debounce(e,t,s=!1){let i=null;return function(){const r=s&&!i,n=()=>e.apply(this,arguments);clearTimeout(i),i=setTimeout(n,t),r&&n()}}function copyToClipboard(e,t=(()=>{}),s=(()=>{})){navigator.clipboard.writeText(e).then(function(){t(e)},function(e){s(e)})}const jetSmartFiltersSettinsMixin={data:function(){return{data:window.jetSmartFiltersSettingsConfig.data,settings:window.jetSmartFiltersSettingsConfig.settings,preparedOptions:{},savingStatus:!1,ajaxSaveHandler:null,repeaterItemCollapsed:!0}},watch:{settings:{handler(e){const t={};for(const s in e)t[s]=e[s];this.preparedOptions=t,this.saveOptions()},deep:!0}},computed:{directUrl(){return this.urlAliasesTransform(this.url)}},mounted:function(){this.repeaterItemCollapsed=!1},methods:{saveOptions:debounce(function(){this.ajaxSaveSettings({settings:this.preparedOptions})},300),ajaxSaveSettings(e,t=(()=>{})){var s=this;s.savingStatus=!0,s.ajaxSaveHandler=jQuery.ajax({type:"POST",url:window.jetSmartFiltersSettingsConfig.settingsApiUrl,dataType:"json",data:e,beforeSend:function(e,t){e.setRequestHeader("X-WP-Nonce",window.jetSmartFiltersSettingsConfig.nonce),null!==s.ajaxSaveHandler&&s.ajaxSaveHandler.abort()},success:function(e,i,r){s.savingStatus=!1,"success"===e.status&&(s.$CXNotice.add({message:e.message,type:"success",duration:3e3}),t("success")),"error"===e.status&&(s.$CXNotice.add({message:e.message,type:"error",duration:3e3}),t("error"))}})},repeaterAddItem:function(e,t){t.push(e)},repeaterCloneItem:function(e,t){t.splice(e+1,0,clone(t[e]))},repeaterDeleteItem:function(e,t){t.splice(e,1)},updateAlias(e,t,s){const i=this.settings.url_aliases[t];i&&i[s]!==e&&(i[s]=e)},onAliasInputEvent(e,t,s){("keypress"===e.type&&13===e.keyCode||"blur"===e.type)&&this.updateAlias(e.target.value,t,s)},updateProviderPreloaderCSS(){const{use_bg:e,size:t,color:s,border_radius:i,bg_color:r,padding:n}=this.settings.provider_preloader_styles;let l=".jsf_provider-preloader{";l+=`font-size:${t}px;`,l+=`color:${s};`,e&&(l+=`border-radius:${i}px;`,l+=`background:${r};`,l+=`padding:${n.top}px ${n.right}px ${n.bottom}px ${n.left}px;`,l+="box-shadow:1px 2px 8px rgba(35,40,45,.2);"),l+="}",this.settings.provider_preloader_css=l},changeProviderPreloaderTemplate(e){const t=jQuery(".provider-preloader-preview__container");t.addClass("provider-preloader-template-loading"),jQuery.ajax({url:window.jetSmartFiltersSettingsConfig.ajaxurl,type:"POST",dataType:"json",data:{action:"jet_smart_filters_get_provider_preloader_template",type:e}}).done(e=>{const s=e.data;s&&s.template&&(t.removeClass("provider-preloader-template-loading"),t.html(s.template))})}}},seoSitemapFiltersOptions=clone(window.jetSmartFiltersSettingsConfig.data.seo_sitemap_filters_options),SEORuleItem={template:"#jet-smart-filters-seo-rule-item",props:{value:{type:Object,default:()=>[]}},computed:{selectedFiltersMacroOptions:function(){const e=[];let t=[...seoSitemapFiltersOptions];return this.value.filters.forEach(s=>{const i=t.findIndex(e=>e.value===s);if(-1===i)return;const r={...t[i]};r.value&&(r.value="filter_"+r.value),r.fields=[{label:"Text before",type:"input"},{label:"Text after",type:"input"},{label:"Fallback",type:"input"}],["checkboxes","color-image"].includes(r.type)&&r.fields.push({label:"Delimiter",type:"input"},{label:"Last item delimiter",type:"input"}),e.push(r)}),e}},data:()=>({providersListOptions:clone(window.jetSmartFiltersSettingsConfig.data.providers_list_options)}),methods:{getAllowedFiltersOptions(e){let t=[...seoSitemapFiltersOptions];if(!this.value.filters.length)return t;const s=[...this.value.filters];return s.splice(e,1),t.filter(e=>!s.includes(e.value))}}},seoRulesSettinsMixin={components:{RuleItem:SEORuleItem},data:function(){return{seoSitemapRulesSettings:this.getRulesSettings(),seoSitemapRulesSaving:!1,xmlPath:window.jetSmartFiltersSettingsConfig.data.seo_sitemap_xml_path,xmlUrl:window.jetSmartFiltersSettingsConfig.data.seo_sitemap_xml_url,copyXmlUrlClass:""}},methods:{getRulesSettings(){const e=clone(window.jetSmartFiltersSettingsConfig.settings.seo_sitemap_rules)||[];return e.forEach(e=>{e.hasOwnProperty("url")||(e.url=""),e.hasOwnProperty("provider")||(e.provider=""),e.hasOwnProperty("query_id")||(e.url=""),e.hasOwnProperty("filters")&&Array.isArray(e.filters)||(e.filters=[]),e.hasOwnProperty("title")||(e.title=""),e.hasOwnProperty("description")||(e.description="")}),e},getRuleTitle(e){const t=this.seoSitemapRulesSettings[e];let s="Page: ";return s+=t.url?"<strong>"+t.url+"</strong>":"<i>empty</i>",s+=" â€” ",s+="Provider: ",t.provider?(s+="<strong>"+t.provider,t.query_id&&(s+=":"+t.query_id),s+="</strong>"):s+="<i>empty</i>",s},saveRules(){this.seoSitemapRulesSaving=!0,this.ajaxSaveSettings({key:"seo_sitemap_rules",settings:this.seoSitemapRulesSettings},e=>{this.seoSitemapRulesSaving=!1})},copyXmlUrl(){copyToClipboard(this.xmlUrl,()=>{this.copyXmlUrlClass="seo-sitemap-rules-xml-path-copy-success"},()=>{this.copyXmlUrlClass="seo-sitemap-rules-xml-path-copy-error"}),setTimeout(()=>{this.copyXmlUrlClass=""},1e3)}}};Vue.component("jet-smart-filters-general-settings",{template:"#jet-dashboard-jet-smart-filters-general-settings",mixins:[jetSmartFiltersSettinsMixin]}),Vue.component("jet-smart-filters-indexer-settings",{template:"#jet-dashboard-jet-smart-filters-indexer-settings",mixins:[jetSmartFiltersSettinsMixin]}),Vue.component("jet-smart-filters-url-structure-settings",{template:"#jet-dashboard-jet-smart-filters-url-structure-settings",mixins:[jetSmartFiltersSettinsMixin]}),Vue.component("jet-smart-filters-seo-rules-settings",{template:"#jet-dashboard-jet-smart-filters-seo-rules-settings",mixins:[jetSmartFiltersSettinsMixin,seoRulesSettinsMixin]}),Vue.component("jet-smart-filters-ajax-request-settings",{template:"#jet-dashboard-jet-smart-filters-ajax-request-settings",mixins:[jetSmartFiltersSettinsMixin]}),Vue.component("jet-smart-filters-provider-preloader",{template:"#jet-dashboard-jet-smart-filters-provider-preloader",mixins:[jetSmartFiltersSettinsMixin]}),Vue.component("jet-smart-filters-accessibility-settings",{template:"#jet-dashboard-jet-smart-filters-accessibility-settings",mixins:[jetSmartFiltersSettinsMixin]}),Vue.component("jet-smart-filters-compatibility",{template:"#jet-dashboard-jet-smart-filters-compatibility",mixins:[jetSmartFiltersSettinsMixin]}),Vue.component("jsf-repeater",{template:"#jet-smart-filters-repeater",props:{value:{type:Array,default:()=>[]},label:{type:String,default:""},actionsEnabled:{type:Boolean,default:!0},addText:{type:String,default:"Add"},defaultItem:{default:null}},methods:{onAddItemClick(){null!==this.defaultItem&&this.value.push(this.defaultItem),this.$emit("add-item")},onRemoveItemClick(e){this.value.splice(e,1),this.$emit("delete-item",e)}}}),Vue.component("jsf-macro-input",{template:"#jet-smart-filters-macro-input",props:{value:{type:String,default:""},label:{type:String,default:""},placeholder:{type:String,default:null},options:{type:Array,default:()=>({})}},data:function(){return{dropdownOpened:!1,suboptions:!1,inputFieldEl:null}},mounted:function(){this.inputFieldEl=this.$refs.inputField},destroyed:function(){document.removeEventListener("mousedown",this.onDocumentClick)},computed:{optionsList:function(){const e=[];for(const t in this.options){let s={};if(this.options[t]instanceof Object){if((s=this.options[t]).fields){s.controls=[],s.controlValues=[];for(const e in s.fields){const t=s.fields[e];if(t.type){if(t.is="cx-vui-"+t.type,delete t.type,t.options){const e=[];for(const s in t.options)e.push({value:s,label:t.options[s]});t.optionsList=e,delete t.options}s.controls.push({id:e,...t})}}delete s.fields}}else s={value:t,label:this.options[t]};e.push(s)}return e}},methods:{insertMacro(e){e="{{"+e+"}}";const t=this.inputFieldEl.selectionStart,s=this.inputFieldEl.selectionEnd,i=this.value.slice(0,t)+e+this.value.slice(s);this.updateValue(i),this.$nextTick(()=>{this.inputFieldEl.setSelectionRange(t+e.length,t+e.length),this.inputFieldEl.focus()}),this.closeDropdown()},openDropdown(){this.dropdownOpened=!0,document.addEventListener("mousedown",this.onDocumentClick)},closeDropdown(){this.dropdownOpened=!1,this.suboptions=!1,document.removeEventListener("mousedown",this.onDocumentClick)},onOptionClick(e){e.controls?this.suboptions=clone(e):this.insertMacro(e.value)},onDropdownButtonClick(){this.dropdownOpened?this.closeDropdown():this.openDropdown()},onSuboptionsChange(e,t){this.suboptions.controlValues[t]=e},onSuboptionsAddClick(){let e=this.suboptions.value;for(let t=0;t<this.suboptions.controlValues.length;t++){const s=this.suboptions.controlValues[t];e+="::",s&&(e+=s)}this.insertMacro(e)},onSuboptionsBackClick(){this.suboptions=!1},onDocumentClick(e){this.$el&&this.$el!==e.target&&!this.$el.contains(e.target)&&this.closeDropdown()},updateValue(e){this.$emit("input",e)}}}),Vue.component("jsf-url-aliases-example",{template:"#jet-smart-filters-url-aliases-example",props:{value:{type:String,default:""},aliases:{type:Array,default:()=>[]},urlPrefix:{type:String,default:"http://demo.org/"},defaultUrl:{type:String,default:""}},data:function(){return{url:this.value,directOpened:!1,reverseOpened:!1,isUrlEdite:!1}},computed:{directUrl(){return this.urlAliasesTransform(this.url)},reverseUrl(){return this.urlAliasesTransform(this.directUrl,!0)},directTransformations(){return this.urlAliasesTransformations(this.url)},reverseTransformations(){return this.urlAliasesTransformations(this.directUrl,!0)},isUrl(){return!!this.url&&/[\/|\?|\&]jsf[\/|=]/.test(this.url)},isNotDefaultUrl(){return this.defaultUrl&&this.url!==this.defaultUrl},isMatches(){return this.directTransformations.length>0||this.reverseTransformations.length>0}},watch:{value(e){this.url=e}},methods:{urlAliasesTransformations(e,t=!1){const s=[];let i=e,r=0;return this.aliases.forEach(n=>{if(r++,!n.needle||!n.replacement)return;const l=e.indexOf(t?n.replacement:n.needle);if(l>-1){const o=l+(t?n.needle.length:n.replacement.length);e=t?e.replace(n.replacement,n.needle):e.replace(n.needle,n.replacement),i=e.slice(0,l)+'<span class="highlight">'+e.slice(l,o)+"</span>"+e.slice(o),s.push({url:e,html:i,replacement:{from:t?n.replacement:n.needle,to:t?n.needle:n.replacement},index:r})}}),s},urlAliasesTransform(e,t=!1){return this.aliases.forEach(s=>{s.needle&&s.replacement&&(e=t?e.replace(s.replacement,s.needle):e.replace(s.needle,s.replacement))}),e},onUrlInput(e){},onUrlEditClick(){this.isUrlEdite=!0,this.$nextTick(()=>this.$refs.urlInput.focus())},onUrlEditRestoreClick(){this.isNotDefaultUrl&&this.$emit("input",this.defaultUrl)},onUrlEditConfirmClick(){const e=jQuery(this.$el).find(".url-aliases-example-string-editor-input").val();e!==this.value&&this.$emit("input",e),this.isUrlEdite=!1},onUrlEditCancelClick(){this.url=this.value,this.isUrlEdite=!1},onDirectClick(){this.directOpened=!this.directOpened},onReverseClick(){this.reverseOpened=!this.reverseOpened}}}),Vue.component("v-style",{render:function(e){return e("style",this.$slots.default)}});