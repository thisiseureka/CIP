!function(e){const t={body:e("body"),element:document.getElementById("menu-to-edit"),settingModal:e("#bdt-ep-megamenu-modal"),init(){this.initBodyEvent(),this.initPlugins(),this.megaMenuSettingEvent(),this.onSaveSettings(),this.openElementorEditor(),this.closeElementorEditor()},megaMenuModal:(t="")=>e("#bdt-ep-megamenu-modal "+t),elementorEditor:(t="")=>e("#ep-megamenu-content "+t),elementorEditorConfirmation:(t="")=>e("#ep-megamenu-editor-confirmation "+t),initPlugins(){t.megaMenuModal(".ep-menu-colorpicker").wpColorPicker(),AestheticIconPicker({selector:"#icon-picker-wrap",onClick:"#select-icon"})},megaMenuSettingEvent(){t.element.addEventListener("cardupdate",(function(t){t.detail.isEnabled?e("#menu-item-"+t.detail.menuID).addClass("ep-megamenu-active"):e("#menu-item-"+t.detail.menuID).removeClass("ep-megamenu-active")})),e.each(megaMenuBuilder.items,(function(t,n){e(n).length&&e(n).addClass("ep-megamenu-active")})),t.megaMenuModal("#bdt-item-enable").on("change",(function(){e(this).is(":checked")?(t.megaMenuModal("#ep-content-trigger").prop("disabled",!1),t.megaMenuModal("#ep-megamenu-toggler").addClass("ep_megamenu_enabled")):(t.megaMenuModal("#ep-megamenu-toggler").removeClass("ep_megamenu_enabled"),t.megaMenuModal("#ep-content-trigger").prop("disabled",!0))})),t.megaMenuModal("#ep-content-width-type").on("change",(function(){"custom_width"===this.value?t.megaMenuModal("#ep-megamenu-custom-content").show():t.megaMenuModal("#ep-megamenu-custom-content").hide()}))},onSaveSettings(){t.megaMenuModal(".ep-item-save").on("click",(function(){var n=e(this).parent().find(".spinner"),a={action:"ep_save_menu_item_settings",nonce:megaMenuBuilder.nonce,settings:{menu_id:t.megaMenuModal("#ep-modal-menu-id").val(),menu_has_child:t.megaMenuModal("#ep-has-child").val(),menu_enable:t.megaMenuModal("#bdt-item-enable:checked").val(),menu_trigger_effect:t.megaMenuModal("#mega-menu-trigger-effect").val(),menu_mobile_content_type:t.megaMenuModal("#mobile_submenu_content_type").val(),menu_width_type:t.megaMenuModal("#ep-content-width-type").val(),custom_menu_position:t.megaMenuModal("#ep-megamenu-custom-position-value").val(),menu_badge_label:t.megaMenuModal("#ep-badge-text-field").val(),menu_custom_width:t.megaMenuModal("#ep-custom-width-value").val(),megamenu_badge_color:t.megaMenuModal("#ep-badge-text-color").val(),menu_badge_bgcolor:t.megaMenuModal("#ep-badge-text-bgcolor").val(),megamenu_icon:t.megaMenuModal("#icon_value").val(),megamenu_icon_library:t.megaMenuModal("#icon_library").val(),megamenu_icon_color:t.megaMenuModal("#ep-icon-color").val()},nocache:Math.floor(Date.now()/1e3)};n.addClass("loading"),e.ajax({url:ajaxurl,type:"post",data:a,success:function(e){t.megaMenuModal(".ep-save-notice").fadeIn("slow"),t.megaMenuModal(".ep-save-notice").html(e.message),setTimeout((function(){t.megaMenuModal(".ep-save-notice").fadeOut("slow")}),1500),n.removeClass("loading")}}),a={menuID:e("#ep-modal-menu-id").val(),isEnabled:e("#bdt-item-enable:checked").val()},t.element.dispatchEvent(new CustomEvent("cardupdate",{detail:a}))}))},openElementorEditor(){t.megaMenuModal("#ep-content-trigger").on("click",(function(){var n,a=t.megaMenuModal("#ep-modal-menu-id").val();e.ajax({url:ajaxurl,type:"post",data:{action:"ep_get_content_editor",key:a},success:function(e){n=e,t.elementorEditor("#ep-megamenu-iframe").empty(),t.elementorEditor("#ep-megamenu-iframe").attr("src",n),bdtUIkit.modal(t.elementorEditor()).show()}})}))},closeElementorEditor(){t.elementorEditor(".close-mega-menu-modal").on("click",(function(e){e.preventDefault();const n=document.getElementById("ep-megamenu-iframe"),a=n.contentWindow||n.contentDocument;a.jQuery("#elementor-panel-saver-button-publish").hasClass("elementor-disabled")?setTimeout((function(){a.jQuery(a).off("beforeunload"),bdtUIkit.modal(t.elementorEditorConfirmation(),{stack:!0}).hide(),bdtUIkit.modal(t.elementorEditor()).hide()}),400):bdtUIkit.modal(t.elementorEditorConfirmation(),{stack:!0}).show()})),t.elementorEditorConfirmation(".confirmation-ok").on("click",(function(e){e.preventDefault();const n=document.getElementById("ep-megamenu-iframe"),a=n.contentWindow||n.contentDocument;a.jQuery("#elementor-panel-saver-button-publish").trigger("click"),setTimeout((function(){a.jQuery(a).off("beforeunload"),bdtUIkit.modal(t.elementorEditorConfirmation(),{stack:!0}).hide(),bdtUIkit.modal(t.elementorEditor()).hide()}),1e3)})),t.elementorEditorConfirmation(".confirmation-cancel").on("click",(function(e){e.preventDefault();const n=document.getElementById("ep-megamenu-iframe"),a=n.contentWindow||n.contentDocument;setTimeout((function(){a.jQuery(a).off("beforeunload"),bdtUIkit.modal(t.elementorEditorConfirmation(),{stack:!0}).hide(),bdtUIkit.modal(t.elementorEditor()).hide()}),400)}))},initBodyEvent(){const n=e("#nav-menu-header"),a=e("#menu-to-edit"),o=()=>{const n=e("#ep-is-metabox-enabled").is(":checked");t.body.toggleClass("ep_megamenu_enabled",n).toggleClass("ep_megamenu_disabled",!n)},m=new MutationObserver((()=>setTimeout(o,200)));n.length&&m.observe(n[0],{childList:!0,subtree:!0});const i=new MutationObserver((()=>{a.find("li.menu-item").each((function(){0===e(this).find(".ep-menu-trigger-btn").length&&e(this).find(".item-title").append('\n                    <a class="ep-menu-trigger-btn" href="#bdt-ep-megamenu-modal">\n                        <span class="ep-megeamenu">Edit</span>\n                        <span class="ep-megeamenu-edit">Edit</span>\n                    </a>\n                ')}))}));a.length&&i.observe(a[0],{childList:!0,subtree:!0}),n.on("change.ekit","#ep-is-metabox-enabled",o),e(window.ep_mega_menu_trigger_button).insertAfter("#nav-menu-header #menu-name").parent().find("#ep-megamenu-switcher").trigger("change.ekit"),a.on("click",".ep-menu-trigger-btn",(function(n){n.preventDefault();const a=e(this).closest("li.menu-item"),o=parseInt(a.attr("id").match(/\d+/)[0],10),m=a.hasClass("menu-item-depth-0");t.settingModal.toggleClass("ep-menu-has-child",!m);const i=m?"content":"icon";e(".ep_menu_control_nav > li, .attr-tab-pane").removeClass("attr-active"),e(`#attr_${i}_nav, #attr_${i}_tab`).addClass("attr-active"),e("#ep-modal-menu-id").val(o),e("#ep-has-child").val(m?0:1);const l={action:"ep_get_menu_item_settings",menu_id:o,menu_width_type:t.megaMenuModal("#ep-content-width-type").val(),custom_menu_position:t.megaMenuModal("#ep-megamenu-custom-position-value").val(),menu_badge_label:t.megaMenuModal("#ep-badge-text-field").val(),menu_custom_width:t.megaMenuModal("#ep-custom-width-value").val(),megamenu_badge_color:t.megaMenuModal("#ep-badge-text-color").val(),menu_badge_bgcolor:t.megaMenuModal("#ep-badge-text-bgcolor").val(),megamenu_icon:t.megaMenuModal("#icon_value").val(),megamenu_icon_library:t.megaMenuModal("#icon_library").val(),megamenu_icon_color:t.megaMenuModal("#ep-icon-color").val(),nocache:Math.floor(Date.now()/1e3)};e.post(ajaxurl,l,(e=>{[{selector:"#ep-badge-text-field",value:e.menu_badge_label},{selector:"#ep-custom-width-value",value:e.menu_custom_width},{selector:"#ep-badge-text-color",value:e.megamenu_badge_color},{selector:"#ep-badge-text-bgcolor",value:e.menu_badge_bgcolor},{selector:"#icon_value",value:e.megamenu_icon},{selector:"#icon_library",value:e.megamenu_icon_library},{selector:"#ep-icon-color",value:e.megamenu_icon_color},{selector:"#mega-menu-trigger-effect",value:e.menu_trigger_effect},{selector:"#mobile_submenu_content_type",value:e.menu_mobile_content_type}].forEach((e=>t.megaMenuModal(e.selector).val(e.value))),t.megaMenuModal("#ep-content-width-type").val(e.menu_width_type||"default_width").change(),t.megaMenuModal("#ep-megamenu-custom-position-value").val(e.custom_menu_position||"bottom-left").change(),t.megaMenuModal("#bdt-item-enable").prop("checked",!!e.menu_enable).trigger("change")}),"json"),bdtUIkit.modal(t.settingModal).show()}))}};t.init()}(jQuery,bdtUIkit);